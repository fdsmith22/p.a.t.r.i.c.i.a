<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P.A.T.R.I.C.I.A - Advanced Psychometric Assessment</title>
    <meta name="description" content="Comprehensive personality assessment integrating Big Five, HEXACO, neurodiversity screening, and cognitive profiling">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="enhanced-styles.css">
    <link rel="stylesheet" href="ultimate-visual-overhaul.css">
    <link rel="stylesheet" href="enhanced-questions.css">
    <link rel="stylesheet" href="enhanced-title.css">
    <!-- Comprehensive fix must be loaded last to override conflicts -->
    <link rel="stylesheet" href="comprehensive-fix.css">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="visual-interactions.js" defer></script>
    <script src="enhanced-questions.js" defer></script>
    <script src="question-integration.js" defer></script>
    <script src="enhanced-title.js" defer></script>
    
    <style>
        :root {
            --neural-blue: #6B9BD1;
            --neural-purple: #A584B7;
            --neural-teal: #5EBAA0;
            --neural-coral: #F09090;
            --neural-gold: #E5B055;
            --neural-green: #6FAE8D;
            
            --bg-primary: #1A1F2E;
            --bg-secondary: #242937;
            --bg-tertiary: #2D3344;
            --bg-card: #363D52;
            
            --text-primary: #E0E4EA;
            --text-secondary: #B8C0D0;
            --text-tertiary: #8B95A8;
            
            --border-color: #3D4556;
            --border-active: #7BA7D7;
            
            --success: #6FAE8D;
            --warning: #E5B055;
            --error: #D68585;
            --info: #7BA7D7;
        }

        [data-theme="light"] {
            --neural-blue: #8BADD3;
            --neural-purple: #B199C4;
            --neural-teal: #7DC5B3;
            --neural-coral: #F5A8A8;
            --neural-gold: #E8C078;
            --neural-green: #8BBAA5;
            
            --bg-primary: #FDF9F5;
            --bg-secondary: #FAF6F2;
            --bg-tertiary: #F5F0EA;
            --bg-card: #FFFFFF;
            
            --text-primary: #3D3D3D;
            --text-secondary: #5D5D5D;
            --text-tertiary: #7D7D7D;
            
            --border-color: #E8E2DA;
            --border-active: #9BBDDA;
            
            --success: #8BBAA5;
            --warning: #E8C078;
            --error: #E5A0A0;
            --info: #9BBDDA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Neural Network Background Animation */
        .neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.03;
            pointer-events: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 3rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, var(--neural-purple) 0%, transparent 70%);
            opacity: 0.1;
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.1); opacity: 0.15; }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .header .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
        }

        /* Progress System */
        .progress-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .progress-container.minimized {
            padding: 0.5rem 1rem;
        }
        
        .progress-container.minimized .progress-stats,
        .progress-container.minimized .progress-bar {
            display: none;
        }
        
        .progress-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .progress-toggle:hover {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--border-active);
        }
        
        .progress-toggle-icon {
            transition: transform 0.3s ease;
        }
        
        .progress-container.minimized .progress-toggle-icon {
            transform: rotate(180deg);
        }
        
        .progress-minimized-text {
            display: none;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .progress-container.minimized .progress-minimized-text {
            display: inline;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .progress-stat {
            text-align: center;
        }

        .progress-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--neural-blue);
        }

        .progress-stat-label {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Assessment Container */
        .assessment-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                max-width: 100%;
            }
            
            .header {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
                line-height: 1.2;
            }
            
            .header .subtitle {
                font-size: 1rem;
            }
            
            .assessment-card {
                padding: 1.25rem;
                border-radius: 15px;
            }
            
            .progress-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .progress-stat {
                padding: 0.75rem;
            }
            
            .option-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .visual-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.6rem;
            }
            
            .visual-option {
                padding: 0.75rem 0.5rem;
                font-size: 0.8rem;
            }
            
            .visual-option .emoji {
                font-size: 1.5rem;
            }
            
            .frequency-grid {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .frequency-grid table {
                min-width: 500px;
            }
            
            .question-text {
                font-size: 1.1rem;
                line-height: 1.4;
            }
            
            .question-instruction {
                font-size: 0.9rem;
                color: var(--text-secondary);
                margin-top: 0.5rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .nav-button {
                width: 100%;
                padding: 1rem;
            }
            
            .slider-container {
                padding: 1rem 0;
            }
            
            .time-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .scenario-option {
                padding: 1rem;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .visual-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .progress-toggle {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
            
            .header h1 {
                font-size: 1.4rem;
            }
            
            .time-options {
                grid-template-columns: 1fr;
            }
            
            .progress-stats {
                grid-template-columns: 1fr;
            }
            
            .question-text {
                font-size: 1rem;
            }
        }
        
        /* Touch-friendly interactions */
        @media (hover: none) and (pointer: coarse) {
            .visual-option,
            .scenario-option,
            .time-option,
            .nav-button {
                -webkit-tap-highlight-color: transparent;
            }
            
            .visual-option:active,
            .scenario-option:active {
                transform: scale(0.98);
            }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .question-number {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            font-weight: 600;
            color: var(--neural-blue);
        }

        .question-category {
            padding: 0.25rem 0.75rem;
            background: var(--neural-purple);
            background: linear-gradient(135deg, var(--neural-purple) 0%, var(--neural-blue) 100%);
            border-radius: 20px;
            font-size: 0.875rem;
            color: white;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            line-height: 1.4;
        }

        /* Question Types */
        
        /* Visual Grid */
        .visual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .visual-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .visual-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--neural-blue) 0%, transparent 70%);
            transition: all 0.5s ease;
            transform: translate(-50%, -50%);
        }

        .visual-option:hover {
            transform: translateY(-2px);
            border-color: var(--neural-blue);
        }

        .visual-option.selected {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
            border-color: var(--neural-blue);
        }

        .visual-option.selected::before {
            width: 200%;
            height: 200%;
            opacity: 0.1;
        }

        .visual-emoji {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .visual-text {
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* Likert Scale */
        .likert-scale {
            padding: 1.5rem 0;
        }
        
        .likert-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0 0.5rem;
        }
        
        .likert-label {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            text-align: center;
            flex: 1;
        }
        
        .likert-options {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
        }
        
        .likert-option {
            flex: 1;
            text-align: center;
        }
        
        .likert-radio {
            display: none;
        }
        
        .likert-button {
            display: block;
            width: 100%;
            padding: 1rem 0.5rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .likert-radio:checked + .likert-button {
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
            border-color: var(--neural-blue);
            transform: scale(1.05);
        }
        
        .likert-button:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-active);
        }
        
        /* Frequency Scale */
        .frequency-scale {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.75rem;
            padding: 1.5rem 0;
        }
        
        .frequency-option-single {
            position: relative;
        }
        
        .frequency-radio {
            display: none;
        }
        
        .frequency-button {
            display: block;
            width: 100%;
            padding: 1.25rem 0.75rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .frequency-radio:checked + .frequency-button {
            background: linear-gradient(135deg, var(--neural-teal) 0%, var(--neural-green) 100%);
            color: white;
            border-color: var(--neural-teal);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(94, 186, 160, 0.3);
        }
        
        .frequency-button:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-active);
            transform: translateY(-1px);
        }
        
        /* Problem Solving */
        .problem-container {
            padding: 2rem 0;
        }
        
        .problem-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }
        
        .problem-input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .problem-input:focus {
            outline: none;
            border-color: var(--neural-blue);
            background: var(--bg-tertiary);
        }
        
        .problem-hint {
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: var(--text-tertiary);
            font-style: italic;
        }
        
        /* Instrument Info */
        .instrument-info {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-left: 3px solid var(--neural-purple);
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--text-tertiary);
            opacity: 0.8;
        }
        
        /* Situational Judgment Tests */
        .situational-judgment {
            padding: 1.5rem 0;
        }
        
        .situation-context {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            border-left: 4px solid var(--neural-gold);
        }
        
        .judgment-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .judgment-option {
            position: relative;
        }
        
        .judgment-radio {
            display: none;
        }
        
        .judgment-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .judgment-radio:checked + .judgment-label {
            background: linear-gradient(135deg, var(--neural-gold) 0%, var(--neural-coral) 100%);
            color: white;
            border-color: var(--neural-gold);
            transform: translateX(4px);
        }
        
        .judgment-label:hover {
            border-color: var(--border-active);
            background: var(--bg-card);
        }
        
        .judgment-style {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            opacity: 0.8;
        }
        
        /* Forced Choice */
        .forced-choice {
            padding: 1.5rem 0;
        }
        
        .forced-prompt {
            font-size: 1.15rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--text-primary);
        }
        
        .forced-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .forced-option {
            position: relative;
        }
        
        .forced-radio {
            display: none;
        }
        
        .forced-button {
            display: block;
            width: 100%;
            padding: 1.5rem 1rem;
            background: var(--bg-secondary);
            border: 3px solid var(--border-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .forced-radio:checked + .forced-button {
            background: var(--bg-card);
            border-color: var(--neural-purple);
            box-shadow: 0 0 0 3px rgba(165, 132, 183, 0.2);
            transform: scale(1.02);
        }
        
        .forced-button:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-active);
        }
        
        /* Visual Scale */
        .visual-scale {
            padding: 1.5rem 0;
        }
        
        .visual-instruction {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .visual-scale-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
        }
        
        .visual-scale-option {
            position: relative;
        }
        
        .visual-scale-radio {
            display: none;
        }
        
        .visual-scale-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .visual-scale-radio:checked + .visual-scale-label {
            background: linear-gradient(135deg, var(--neural-teal) 0%, var(--neural-blue) 100%);
            color: white;
            border-color: var(--neural-teal);
            transform: translateY(-4px);
        }
        
        .visual-representation {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .visual-description {
            font-size: 0.75rem;
            text-align: center;
            opacity: 0.9;
        }
        
        /* Rapid Association */
        .rapid-association {
            padding: 2rem 0;
        }
        
        .rapid-prompt {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        
        .rapid-instruction {
            font-size: 0.9rem;
            color: var(--warning);
            margin-bottom: 1rem;
            text-align: center;
            font-style: italic;
        }
        
        .rapid-input {
            width: 100%;
            padding: 1.25rem;
            font-size: 1.1rem;
            background: var(--bg-secondary);
            border: 3px solid var(--border-active);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .rapid-input:focus {
            outline: none;
            border-color: var(--neural-coral);
            background: var(--bg-tertiary);
            box-shadow: 0 0 20px rgba(240, 144, 144, 0.2);
        }
        
        .rapid-timer {
            margin-top: 1rem;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--neural-coral) 0%, var(--warning) 100%);
            width: 100%;
            transition: width linear;
            transform-origin: left;
        }
        
        .timer-bar.active {
            animation: timerCountdown var(--timer-duration) linear forwards;
        }
        
        @keyframes timerCountdown {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        /* Word Association */
        .word-association {
            padding: 1.5rem 0;
        }
        
        .association-prompt {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--text-primary);
        }
        
        .word-pairs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .word-pair-option {
            position: relative;
        }
        
        .pair-radio {
            display: none;
        }
        
        .pair-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1.25rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pair-radio:checked + .pair-label {
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-green) 100%);
            color: white;
            border-color: var(--neural-blue);
            transform: scale(1.05);
        }
        
        .word-1, .word-2 {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .pair-connector {
            opacity: 0.5;
            font-size: 1.2rem;
        }
        
        /* Mode Selection */
        .mode-selector {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }
        
        .mode-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .mode-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .mode-option {
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border: 3px solid var(--border-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .mode-option:hover {
            border-color: var(--neural-blue);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(107, 155, 209, 0.2);
        }
        
        .mode-option.selected {
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
            border-color: var(--neural-purple);
            box-shadow: 0 0 0 3px rgba(165, 132, 183, 0.2);
        }
        
        .mode-option.selected::before {
            content: 'âœ“';
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 30px;
            height: 30px;
            background: var(--neural-purple);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .mode-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .mode-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .mode-features {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }
        
        .mode-feature {
            padding: 0.25rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .mode-feature::before {
            content: 'â€¢';
            color: var(--neural-blue);
        }
        
        /* Slider */
        .slider-container {
            padding: 2rem 0;
        }

        .slider-track {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            position: relative;
            margin: 2rem 0;
        }

        .slider-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            border-radius: 3px;
            width: 50%;
            transition: width 0.3s ease;
        }

        .slider-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid var(--neural-blue);
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .slider-handle:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            color: var(--text-tertiary);
        }

        .slider-value {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neural-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        /* Frequency Grid */
        .frequency-grid {
            overflow-x: auto;
        }

        .frequency-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .frequency-table th,
        .frequency-table td {
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .frequency-table th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .frequency-table td:first-child {
            text-align: left;
            font-weight: 500;
        }

        .frequency-option {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .frequency-option:hover {
            transform: scale(1.1);
            background: var(--neural-blue);
        }

        .frequency-option.selected {
            background: var(--neural-blue);
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }

        .frequency-option.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }

        /* Time Preference */
        .time-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .time-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .time-option:hover {
            border-color: var(--neural-teal);
            transform: translateY(-2px);
        }

        .time-option.selected {
            background: linear-gradient(135deg, rgba(26, 188, 156, 0.1) 0%, rgba(74, 144, 226, 0.1) 100%);
            border-color: var(--neural-teal);
        }

        .time-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Task Ranking */
        .ranking-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1rem;
        }

        .ranking-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            cursor: move;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            transform: translateX(5px);
            border-color: var(--neural-purple);
        }

        .ranking-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .ranking-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .ranking-text {
            flex: 1;
            font-weight: 500;
        }

        .ranking-handle {
            color: var(--text-tertiary);
            font-size: 1.25rem;
        }

        /* Body Mapping */
        .body-map {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 15px;
            position: relative;
        }

        .body-svg {
            width: 300px;
            height: 400px;
        }

        .body-part {
            fill: var(--bg-tertiary);
            stroke: var(--border-color);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .body-part:hover {
            fill: rgba(74, 144, 226, 0.2);
            stroke: var(--neural-blue);
        }

        .body-part.selected {
            fill: rgba(255, 107, 107, 0.3);
            stroke: var(--neural-coral);
            animation: throb 1.5s ease-in-out infinite;
        }

        @keyframes throb {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Results Section */
        .results-container {
            display: none;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .results-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .profile-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-emoji {
            font-size: 4rem;
            background: var(--bg-secondary);
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            border: 2px solid var(--border-color);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--neural-blue);
            margin-bottom: 0.5rem;
        }

        .profile-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Trait Visualization */
        .traits-visualization {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .trait-bars {
            display: grid;
            gap: 1.5rem;
        }

        .trait-bar {
            display: grid;
            grid-template-columns: 150px 1fr 60px;
            align-items: center;
            gap: 1rem;
        }

        .trait-name {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .trait-progress {
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .trait-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .trait-fill.high {
            background: linear-gradient(90deg, var(--neural-green) 0%, var(--neural-teal) 100%);
        }

        .trait-fill.medium {
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
        }

        .trait-fill.low {
            background: linear-gradient(90deg, var(--neural-gold) 0%, var(--neural-coral) 100%);
        }

        .trait-score {
            font-weight: 700;
            color: var(--text-primary);
            text-align: right;
        }

        /* Neurodiversity Indicators */
        .neuro-indicators {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .neuro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .neuro-indicator {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .neuro-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .neuro-label {
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .neuro-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .neuro-value.high {
            color: var(--neural-coral);
        }

        .neuro-value.medium {
            color: var(--neural-gold);
        }

        .neuro-value.low {
            color: var(--neural-green);
        }

        /* Detailed Analysis Tabs */
        .analysis-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
            border-color: transparent;
        }

        .tab-content {
            display: none;
            animation: slideUp 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .analysis-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .analysis-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neural-blue);
            margin-bottom: 1rem;
        }

        .analysis-content {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-item {
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-secondary);
            border-left: 4px solid var(--neural-blue);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            transform: translateX(5px);
            background: var(--bg-tertiary);
        }

        /* Achievement System */
        .achievements {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .achievement {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement.unlocked {
            border-color: var(--neural-gold);
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1) 0%, rgba(241, 196, 15, 0.1) 100%);
        }

        .achievement.unlocked::before {
            content: 'âœ¨';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1rem;
        }

        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            filter: grayscale(1);
            opacity: 0.3;
        }

        .achievement.unlocked .achievement-icon {
            filter: grayscale(0);
            opacity: 1;
        }

        .achievement-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .achievement.unlocked .achievement-name {
            color: var(--neural-gold);
        }

        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.3);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--neural-blue);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        /* Loading State */
        .loading-container {
            display: none;
            text-align: center;
            padding: 4rem;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--neural-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Celebration animation fallback for when confetti is blocked */
        .celebration-animation {
            animation: celebrate 3s ease-out;
        }
        
        @keyframes celebrate {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            10% {
                transform: scale(1.05) rotate(-2deg);
            }
            20% {
                transform: scale(1.02) rotate(2deg);
            }
            30% {
                transform: scale(1.01) rotate(-1deg);
            }
            40% {
                transform: scale(1) rotate(1deg);
            }
        }
        
        .celebration-animation::before {
            content: 'ðŸŽ‰';
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            animation: float-up 3s ease-out;
        }
        
        @keyframes float-up {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(0);
            }
            20% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-100px);
            }
        }

        /* Mode selection styles */
        .mode-option {
            position: relative;
            display: block;
        }

        .mode-option:hover {
            background: rgba(74, 144, 226, 0.1);
            border-color: var(--primary) !important;
        }

        .mode-option input[type="radio"] {
            margin-right: 0.5rem;
        }

        .mode-option input[type="radio"]:checked ~ strong {
            color: var(--primary);
        }

        .mode-option input[type="radio"]:checked ~ p {
            color: var(--text-primary);
        }

        label.mode-option:has(input[type="radio"]:checked) {
            border-color: var(--primary) !important;
            background: rgba(74, 144, 226, 0.1);
        }

        .loading-text {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            color: var(--text-tertiary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .visual-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .trait-bar {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 1000;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            border-color: var(--neural-blue);
        }

        .theme-icon {
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Floating Orbs Background -->
    <div class="floating-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>
    
    <!-- Neural Network Background -->
    <canvas class="neural-bg" id="neuralCanvas"></canvas>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
        <span class="theme-icon">ðŸŒ™</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>P.A.T.R.I.C.I.A</h1>
                <p class="subtitle">
                    Psychometric Assessment Tool for Research-based Individual Character & Insight Analysis
                    <br><small>Integrating Big Five, HEXACO, neurodiversity screening, and cognitive profiling</small>
                </p>
            </div>
        </header>

        <!-- Progress Container -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <button class="progress-toggle" id="progressToggle" onclick="toggleProgress()" title="Toggle progress display">
                <span class="progress-toggle-icon">â–¼</span>
                <span id="toggleText">Hide</span>
            </button>
            <span class="progress-minimized-text" id="minimizedText">Progress tracking minimized â€¢ Click to expand</span>
            <div class="progress-stats">
                <div class="progress-stat">
                    <div class="progress-stat-value" id="questionNumber">0</div>
                    <div class="progress-stat-label">Current Question</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value" id="totalQuestions">0</div>
                    <div class="progress-stat-label">Total Questions</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value" id="timeElapsed">0:00</div>
                    <div class="progress-stat-label">Time Elapsed</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value" id="completionRate">0%</div>
                    <div class="progress-stat-label">Completion</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBar"></div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main id="mainContent">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="assessment-card">
                <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1.5rem; background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Welcome to Your Comprehensive Personality Assessment
                </h2>
                
                <p style="font-size: 1.125rem; color: var(--text-secondary); line-height: 1.8; margin-bottom: 2rem;">
                    This advanced assessment combines validated psychological measures including the Big Five personality model, 
                    HEXACO framework, neurodiversity indicators, and cognitive profiling to provide you with deep, 
                    personalized insights about your unique psychological profile.
                </p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--neural-blue);">
                        <h3 style="color: var(--neural-blue); margin-bottom: 0.5rem;">ðŸ§  What We Measure</h3>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li>âœ“ Personality dimensions & facets</li>
                            <li>âœ“ Neurodivergent traits & patterns</li>
                            <li>âœ“ Cognitive processing styles</li>
                            <li>âœ“ Emotional regulation patterns</li>
                            <li>âœ“ Social & sensory profiles</li>
                        </ul>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--neural-purple);">
                        <h3 style="color: var(--neural-purple); margin-bottom: 0.5rem;">ðŸŽ® Interactive Experience</h3>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li>âœ“ Diverse question formats</li>
                            <li>âœ“ Visual & interactive elements</li>
                            <li>âœ“ Gamified progress tracking</li>
                            <li>âœ“ Achievement system</li>
                            <li>âœ“ Adaptive questioning</li>
                        </ul>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--neural-teal);">
                        <h3 style="color: var(--neural-teal); margin-bottom: 0.5rem;">ðŸ“Š Your Results</h3>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li>âœ“ Detailed personality profile</li>
                            <li>âœ“ Neurodiversity indicators</li>
                            <li>âœ“ Strengths & growth areas</li>
                            <li>âœ“ Career & relationship insights</li>
                            <li>âœ“ Personalized recommendations</li>
                        </ul>
                    </div>
                </div>

                <!-- Mode Selection -->
                <div style="background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%); padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem;">
                    <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Choose Your Assessment Mode</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <label class="mode-option" style="cursor: pointer; padding: 1rem; border: 2px solid var(--card-border); border-radius: 10px; transition: all 0.3s;">
                            <input type="radio" name="assessmentMode" value="validated" checked onchange="updateModeSelection()">
                            <strong>Validated Mode</strong>
                            <p style="margin: 0.5rem 0 0; font-size: 0.9rem; color: var(--text-secondary);">
                                Scientifically validated instruments (BFI-2, HEXACO, clinical screening)
                            </p>
                        </label>
                        
                        <label class="mode-option" style="cursor: pointer; padding: 1rem; border: 2px solid var(--card-border); border-radius: 10px; transition: all 0.3s;">
                            <input type="radio" name="assessmentMode" value="experimental" onchange="updateModeSelection()">
                            <strong>Experimental Mode</strong>
                            <p style="margin: 0.5rem 0 0; font-size: 0.9rem; color: var(--text-secondary);">
                                Cutting-edge measures (2020-2025 research, Eastern philosophy, indigenous frameworks)
                            </p>
                        </label>
                    </div>

                    <!-- Tier Selection for Validated Mode -->
                    <div id="tierSelection" style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary);">
                            <strong>Select Assessment Depth:</strong>
                        </label>
                        <select id="assessmentTier" style="width: 100%; padding: 0.75rem; border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--card-border);">
                            <option value="core">Core Screening (20-25 min)</option>
                            <option value="comprehensive">Comprehensive Assessment (45-60 min)</option>
                            <option value="specialized">Specialized Modules (60+ min)</option>
                        </select>
                    </div>

                    <p style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.5rem;">
                        â±ï¸ <span id="timeEstimate">Estimated time: 20-25 minutes</span>
                    </p>
                    <p style="color: var(--text-secondary); margin: 0;">
                        This assessment is designed to be engaging and insightful. Take your time and answer honestly - 
                        there are no right or wrong answers, only your unique patterns and preferences.
                    </p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="startAssessment()">
                        <span>Begin Your Journey</span>
                        <span>â†’</span>
                    </button>
                </div>
            </div>

            <!-- Assessment Questions -->
            <div id="assessmentContainer" style="display: none;">
                <!-- Questions will be dynamically inserted here -->
            </div>

            <!-- Loading Screen -->
            <div id="loadingScreen" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Analyzing your responses...</div>
                <div class="loading-subtext">Creating your personalized profile</div>
            </div>

            <!-- Results -->
            <div id="resultsContainer" class="results-container">
                <!-- Results will be dynamically inserted here -->
            </div>
        </main>
    </div>

    <script>
        // Embedded personality profiles data
        const personalityProfiles = [
            {
                id: 'analytical_architect',
                name: 'The Analytical Architect',
                emoji: 'ðŸ—ï¸',
                description: 'Systematic thinkers who build understanding through careful analysis and structured approaches.',
                detailedAnalysis: {
                    core: 'Your mind operates like a sophisticated blueprint system, constructing understanding through methodical analysis and logical frameworks.',
                    strengths: [
                        'Exceptional pattern recognition in data and systems',
                        'Strong analytical and critical thinking abilities',
                        'Natural talent for optimization and efficiency',
                        'Detail-oriented approach catches what others miss',
                        'Excellent at creating and following systematic processes'
                    ],
                    growth: 'Balance your analytical strengths with intuitive exploration. Practice making "good enough" decisions when perfection isn\'t necessary.',
                    relationships: 'You value intellectual connection and clear communication. Partners who appreciate your thoughtful approach will be most compatible.',
                    career: ['Data Scientist', 'Software Architect', 'Research Analyst', 'Financial Analyst', 'Systems Engineer'],
                    communication: 'Direct, precise, and fact-based. You prefer written communication for complex topics.'
                },
                traits: {
                    openness: { score: 75 },
                    conscientiousness: { score: 88 },
                    extraversion: { score: 32 },
                    agreeableness: { score: 58 },
                    neuroticism: { score: 42 },
                    honestyHumility: 78
                },
                neurodivergent: {
                    autismTraits: 65,
                    adhdTraits: 25,
                    sensitivity: 55,
                    executiveFunction: 85
                }
            },
            {
                id: 'creative_visionary',
                name: 'The Creative Visionary',
                emoji: 'ðŸŽ¨',
                description: 'Imaginative innovators who see possibilities others miss and bring creative solutions to life.',
                detailedAnalysis: {
                    core: 'Your mind is a kaleidoscope of possibilities, constantly generating novel connections and creative solutions.',
                    strengths: [
                        'Exceptional creative and divergent thinking',
                        'Natural ability to see unconventional solutions',
                        'Strong aesthetic sense and artistic appreciation',
                        'Excellent at brainstorming and ideation',
                        'Adaptable and comfortable with ambiguity'
                    ],
                    growth: 'Channel your creativity through structured projects. Develop systems to capture and implement your ideas effectively.',
                    relationships: 'You need partners who appreciate your creativity and give you freedom to explore.',
                    career: ['Creative Director', 'UX Designer', 'Innovation Consultant', 'Artist', 'Writer', 'Entrepreneur'],
                    communication: 'Metaphorical, enthusiastic, and idea-focused. You excel at visual and storytelling communication.'
                },
                traits: {
                    openness: { score: 92 },
                    conscientiousness: { score: 52 },
                    extraversion: { score: 68 },
                    agreeableness: { score: 72 },
                    neuroticism: { score: 58 },
                    honestyHumility: 70
                },
                neurodivergent: {
                    autismTraits: 45,
                    adhdTraits: 70,
                    sensitivity: 80,
                    executiveFunction: 45
                }
            },
            {
                id: 'social_orchestrator',
                name: 'The Social Orchestrator',
                emoji: 'ðŸŽ­',
                description: 'Natural connectors who bring people together and create harmonious social environments.',
                detailedAnalysis: {
                    core: 'You possess an intuitive understanding of social dynamics and excel at creating connections between people.',
                    strengths: [
                        'Exceptional interpersonal and communication skills',
                        'Natural empathy and emotional attunement',
                        'Strong leadership through collaboration',
                        'Excellent at building and maintaining networks',
                        'Skilled at conflict resolution and mediation'
                    ],
                    growth: 'Set boundaries to protect your energy. Practice assertiveness and prioritize self-care.',
                    relationships: 'You thrive in emotionally connected, communicative relationships.',
                    career: ['HR Director', 'Community Manager', 'Therapist', 'Event Coordinator', 'Public Relations'],
                    communication: 'Warm, inclusive, and emotionally expressive. You excel at verbal communication.'
                },
                traits: {
                    openness: { score: 68 },
                    conscientiousness: { score: 72 },
                    extraversion: { score: 88 },
                    agreeableness: { score: 85 },
                    neuroticism: { score: 48 },
                    honestyHumility: 82
                },
                neurodivergent: {
                    autismTraits: 20,
                    adhdTraits: 35,
                    sensitivity: 75,
                    executiveFunction: 65
                }
            },
            {
                id: 'strategic_commander',
                name: 'The Strategic Commander',
                emoji: 'âš”ï¸',
                description: 'Decisive leaders who combine vision with execution to achieve ambitious goals.',
                detailedAnalysis: {
                    core: 'You are a natural leader with a strategic mind and unwavering determination.',
                    strengths: [
                        'Strong leadership and decision-making abilities',
                        'Excellent strategic planning and execution',
                        'High achievement drive and goal orientation',
                        'Natural confidence and assertiveness',
                        'Skilled at resource optimization'
                    ],
                    growth: 'Develop emotional intelligence alongside strategic thinking. Practice patience.',
                    relationships: 'You need partners who are independent and share your ambition.',
                    career: ['CEO', 'Military Officer', 'Strategic Consultant', 'Entrepreneur', 'Investment Banker'],
                    communication: 'Direct, confident, and goal-focused. You prefer efficient communication.'
                },
                traits: {
                    openness: { score: 72 },
                    conscientiousness: { score: 90 },
                    extraversion: { score: 78 },
                    agreeableness: { score: 52 },
                    neuroticism: { score: 28 },
                    honestyHumility: 62
                },
                neurodivergent: {
                    autismTraits: 35,
                    adhdTraits: 45,
                    sensitivity: 30,
                    executiveFunction: 90
                }
            },
            {
                id: 'empathic_healer',
                name: 'The Empathic Healer',
                emoji: 'ðŸ’š',
                description: 'Deeply compassionate souls who intuitively understand and support others\' emotional journeys.',
                detailedAnalysis: {
                    core: 'You possess profound emotional depth and an intuitive understanding of others\' inner worlds.',
                    strengths: [
                        'Exceptional empathy and emotional intelligence',
                        'Natural counseling and healing abilities',
                        'Strong intuition about people\'s needs',
                        'Deep capacity for compassion',
                        'Excellent at creating safe spaces'
                    ],
                    growth: 'Learn to differentiate between your emotions and others\'. Develop protective boundaries.',
                    relationships: 'You need emotionally available, authentic partners who value depth.',
                    career: ['Therapist', 'Counselor', 'Nurse', 'Social Worker', 'Life Coach'],
                    communication: 'Gentle, validating, and emotionally attuned.'
                },
                traits: {
                    openness: { score: 78 },
                    conscientiousness: { score: 75 },
                    extraversion: { score: 58 },
                    agreeableness: { score: 92 },
                    neuroticism: { score: 55 },
                    honestyHumility: 88
                },
                neurodivergent: {
                    autismTraits: 30,
                    adhdTraits: 25,
                    sensitivity: 92,
                    executiveFunction: 60
                }
            },
            {
                id: 'pattern_weaver',
                name: 'The Pattern Weaver',
                emoji: 'ðŸ•¸ï¸',
                description: 'System thinkers who see hidden connections and create order from complexity.',
                detailedAnalysis: {
                    core: 'Your mind excels at detecting patterns and connections that others miss.',
                    strengths: [
                        'Exceptional pattern recognition',
                        'Deep focus in areas of interest',
                        'Strong logical capabilities',
                        'Excellent specialized memory',
                        'Unique perspective'
                    ],
                    growth: 'Honor your need for structure while building flexibility.',
                    relationships: 'You thrive with partners who appreciate your unique perspective.',
                    career: ['Systems Analyst', 'Data Architect', 'Research Scientist', 'Software Developer'],
                    communication: 'Precise, detailed, and information-rich.'
                },
                traits: {
                    openness: { score: 82 },
                    conscientiousness: { score: 78 },
                    extraversion: { score: 28 },
                    agreeableness: { score: 62 },
                    neuroticism: { score: 65 },
                    honestyHumility: 85
                },
                neurodivergent: {
                    autismTraits: 85,
                    adhdTraits: 30,
                    sensitivity: 78,
                    executiveFunction: 55
                }
            },
            {
                id: 'dynamic_explorer',
                name: 'The Dynamic Explorer',
                emoji: 'ðŸš€',
                description: 'High-energy innovators who thrive on novelty and bring passionate intensity.',
                detailedAnalysis: {
                    core: 'Your mind craves stimulation and novelty, jumping between interests with enthusiasm.',
                    strengths: [
                        'High energy and enthusiasm',
                        'Creative problem-solving',
                        'Hyperfocus abilities',
                        'Excellent in crisis',
                        'Outside-the-box thinking'
                    ],
                    growth: 'Build external structures to support your internal variability.',
                    relationships: 'You need partners who can match your energy.',
                    career: ['Emergency Responder', 'Entrepreneur', 'Creative Director', 'Journalist'],
                    communication: 'Enthusiastic, fast-paced, and idea-jumping.'
                },
                traits: {
                    openness: { score: 85 },
                    conscientiousness: { score: 45 },
                    extraversion: { score: 82 },
                    agreeableness: { score: 65 },
                    neuroticism: { score: 62 },
                    honestyHumility: 65
                },
                neurodivergent: {
                    autismTraits: 25,
                    adhdTraits: 90,
                    sensitivity: 70,
                    executiveFunction: 35
                }
            },
            {
                id: 'sensory_sage',
                name: 'The Sensory Sage',
                emoji: 'ðŸŒº',
                description: 'Highly sensitive perceivers who experience the world with extraordinary depth.',
                detailedAnalysis: {
                    core: 'You experience the world through a heightened sensory and emotional lens.',
                    strengths: [
                        'Extraordinary perception',
                        'Deep aesthetic appreciation',
                        'Strong intuition',
                        'Profound empathy',
                        'Subtle change detection'
                    ],
                    growth: 'Create environments that honor your sensitivity.',
                    relationships: 'You need gentle, understanding partners.',
                    career: ['Artist', 'Therapist', 'Writer', 'Designer', 'Musician'],
                    communication: 'Nuanced, thoughtful, and emotionally rich.'
                },
                traits: {
                    openness: { score: 88 },
                    conscientiousness: { score: 70 },
                    extraversion: { score: 35 },
                    agreeableness: { score: 82 },
                    neuroticism: { score: 68 },
                    honestyHumility: 82
                },
                neurodivergent: {
                    autismTraits: 40,
                    adhdTraits: 20,
                    sensitivity: 95,
                    executiveFunction: 60
                }
            },
            {
                id: 'resilient_phoenix',
                name: 'The Resilient Phoenix',
                emoji: 'ðŸ”¥',
                description: 'Transformation catalysts who turn challenges into growth.',
                detailedAnalysis: {
                    core: 'You have extraordinary capacity for transformation and renewal.',
                    strengths: [
                        'Exceptional resilience',
                        'Deep wisdom',
                        'Growth capacity',
                        'Inspirational presence',
                        'Crisis management'
                    ],
                    growth: 'Allow yourself to be vulnerable and receive support.',
                    relationships: 'You need partners who appreciate both strength and vulnerability.',
                    career: ['Life Coach', 'Trauma Therapist', 'Motivational Speaker', 'Social Entrepreneur'],
                    communication: 'Authentic, inspiring, and wisdom-filled.'
                },
                traits: {
                    openness: { score: 78 },
                    conscientiousness: { score: 75 },
                    extraversion: { score: 68 },
                    agreeableness: { score: 75 },
                    neuroticism: { score: 38 },
                    honestyHumility: 78
                },
                neurodivergent: {
                    autismTraits: 35,
                    adhdTraits: 45,
                    sensitivity: 70,
                    executiveFunction: 75
                }
            }
        ];

        // =====================================
        // VALIDATED ASSESSMENT FRAMEWORKS
        // =====================================
        
        // Assessment configuration with tiered structure
        const assessmentConfig = {
            version: '3.0.0',
            tiers: {
                core: 'Core Screening (20-25 min)',
                comprehensive: 'Comprehensive Assessment (45-60 min)',
                specialized: 'Specialized Modules (as needed)',
                experimental: 'Experimental Cutting-Edge (30-40 min)'
            },
            currentTier: 'core',
            mode: 'validated', // 'validated' or 'experimental'
            adaptiveTesting: true,
            psychometricValidation: true,
            culturalAdaptation: true,
            biometricTracking: false
        };

        // Psychometric properties and norms
        const psychometricData = {
            bigFive: {
                reliability: { min: 0.82, max: 0.85 },
                facets: 15,
                items: { full: 60, short: 30 },
                norms: {
                    extraversion: { mean: 3.25, sd: 0.90 },
                    agreeableness: { mean: 3.64, sd: 0.72 },
                    conscientiousness: { mean: 3.45, sd: 0.73 },
                    neuroticism: { mean: 2.97, sd: 0.89 },
                    openness: { mean: 3.66, sd: 0.76 }
                }
            },
            hexaco: {
                reliability: { alpha: 0.80 },
                crossCultural: { countries: 48, n: 347192 },
                genderDifference: { honestyHumility: { d: 0.37 } }
            },
            darkTetrad: {
                reliability: { min: 0.69, max: 0.85 },
                items: 28,
                factors: ['machiavellianism', 'narcissism', 'psychopathy', 'sadism']
            },
            adhd: {
                sensitivity: 0.90,
                specificity: 0.88,
                cutoff: 14,
                auc: 0.904
            },
            autism: {
                sensitivity: 0.97,
                specificity: 1.00,
                cutoff: 65
            },
            stress: {
                communityMean: 15.3,
                sd: 7.49,
                validity: '4-8 weeks'
            },
            resilience: {
                communityMean: 31.8,
                sd: 5.4,
                reliability: { min: 0.85, max: 0.90 }
            }
        };

        // Response bias detection parameters
        const biasDetection = {
            responseTime: {
                minimum: 2000, // milliseconds
                flagThreshold: 1500
            },
            longString: {
                threshold: 5 // consecutive same responses
            },
            socialDesirability: {
                items: ['sd_1', 'sd_2', 'sd_3'] // embedded items
            },
            carelessResponding: {
                mahalonobisThreshold: 3.5
            }
        };

        // =====================================
        // TIER 1: CORE SCREENING QUESTIONS
        // =====================================
        
        const coreScreeningQuestions = [
            // === BFI-2-S: Big Five Inventory Short Form (30 items) ===
            // EXTRAVERSION FACETS
            {
                id: 'bfi2_e1_sociability',
                type: 'likert',
                category: 'extraversion',
                facet: 'sociability',
                text: 'I am someone who is outgoing and sociable',
                scale: 5,
                labels: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'],
                scoring: 'normal',
                instrument: 'BFI-2-S',
                reliability: 0.84
            },
            {
                id: 'bfi2_e2_assertiveness',
                type: 'likert',
                category: 'extraversion',
                facet: 'assertiveness',
                text: 'I am someone who has an assertive personality',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_e3_energy',
                type: 'likert',
                category: 'extraversion',
                facet: 'energy_level',
                text: 'I am someone who is full of energy',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_e4_sociability_r',
                type: 'likert',
                category: 'extraversion',
                facet: 'sociability',
                text: 'I am someone who prefers to have others take the lead',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_e5_assertiveness_r',
                type: 'likert',
                category: 'extraversion',
                facet: 'assertiveness',
                text: 'I am someone who is less active than other people',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_e6_energy_r',
                type: 'likert',
                category: 'extraversion',
                facet: 'energy_level',
                text: 'I am someone who tends to be quiet',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },

            // AGREEABLENESS FACETS
            {
                id: 'bfi2_a1_compassion',
                type: 'likert',
                category: 'agreeableness',
                facet: 'compassion',
                text: 'I am someone who is compassionate and has a soft heart',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_a2_respectfulness',
                type: 'likert',
                category: 'agreeableness',
                facet: 'respectfulness',
                text: 'I am someone who is respectful and treats others with respect',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_a3_trust',
                type: 'likert',
                category: 'agreeableness',
                facet: 'trust',
                text: 'I am someone who assumes the best about people',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_a4_compassion_r',
                type: 'likert',
                category: 'agreeableness',
                facet: 'compassion',
                text: 'I am someone who feels little sympathy for others',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_a5_respectfulness_r',
                type: 'likert',
                category: 'agreeableness',
                facet: 'respectfulness',
                text: 'I am someone who can be cold and uncaring',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_a6_trust_r',
                type: 'likert',
                category: 'agreeableness',
                facet: 'trust',
                text: 'I am someone who is suspicious of others\' intentions',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },

            // CONSCIENTIOUSNESS FACETS
            {
                id: 'bfi2_c1_organization',
                type: 'likert',
                category: 'conscientiousness',
                facet: 'organization',
                text: 'I am someone who is organized',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_c2_productiveness',
                type: 'likert',
                category: 'conscientiousness',
                facet: 'productiveness',
                text: 'I am someone who is persistent and works until the task is finished',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_c3_responsibility',
                type: 'likert',
                category: 'conscientiousness',
                facet: 'responsibility',
                text: 'I am someone who is reliable and can always be counted on',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_c4_organization_r',
                type: 'likert',
                category: 'conscientiousness',
                facet: 'organization',
                text: 'I am someone who tends to be disorganized',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_c5_productiveness_r',
                type: 'likert',
                category: 'conscientiousness',
                facet: 'productiveness',
                text: 'I am someone who tends to be lazy',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_c6_responsibility_r',
                type: 'likert',
                category: 'conscientiousness',
                facet: 'responsibility',
                text: 'I am someone who can be somewhat careless',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },

            // NEGATIVE EMOTIONALITY (NEUROTICISM) FACETS
            {
                id: 'bfi2_n1_anxiety',
                type: 'likert',
                category: 'neuroticism',
                facet: 'anxiety',
                text: 'I am someone who worries a lot',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_n2_depression',
                type: 'likert',
                category: 'neuroticism',
                facet: 'depression',
                text: 'I am someone who tends to feel depressed and blue',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_n3_volatility',
                type: 'likert',
                category: 'neuroticism',
                facet: 'emotional_volatility',
                text: 'I am someone who is temperamental and gets emotional easily',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_n4_anxiety_r',
                type: 'likert',
                category: 'neuroticism',
                facet: 'anxiety',
                text: 'I am someone who is relaxed and handles stress well',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_n5_depression_r',
                type: 'likert',
                category: 'neuroticism',
                facet: 'depression',
                text: 'I am someone who feels secure and comfortable with self',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_n6_volatility_r',
                type: 'likert',
                category: 'neuroticism',
                facet: 'emotional_volatility',
                text: 'I am someone who is emotionally stable and not easily upset',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },

            // OPEN-MINDEDNESS (OPENNESS) FACETS
            {
                id: 'bfi2_o1_curiosity',
                type: 'likert',
                category: 'openness',
                facet: 'intellectual_curiosity',
                text: 'I am someone who is curious about many different things',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_o2_aesthetic',
                type: 'likert',
                category: 'openness',
                facet: 'aesthetic_sensitivity',
                text: 'I am someone who is fascinated by art, music, or literature',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_o3_imagination',
                type: 'likert',
                category: 'openness',
                facet: 'creative_imagination',
                text: 'I am someone who has an active imagination',
                scale: 5,
                scoring: 'normal',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_o4_curiosity_r',
                type: 'likert',
                category: 'openness',
                facet: 'intellectual_curiosity',
                text: 'I am someone who has little interest in abstract ideas',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_o5_aesthetic_r',
                type: 'likert',
                category: 'openness',
                facet: 'aesthetic_sensitivity',
                text: 'I am someone who has little creative ability',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },
            {
                id: 'bfi2_o6_imagination_r',
                type: 'likert',
                category: 'openness',
                facet: 'creative_imagination',
                text: 'I am someone who has difficulty imagining things',
                scale: 5,
                scoring: 'reverse',
                instrument: 'BFI-2-S'
            },

            // === HEXACO-60 HONESTY-HUMILITY ITEMS ===
            {
                id: 'hexaco_h1_sincerity',
                type: 'likert',
                category: 'honesty_humility',
                facet: 'sincerity',
                text: 'I wouldn\'t use flattery to get a raise or promotion at work, even if I thought it would succeed',
                scale: 5,
                scoring: 'normal',
                instrument: 'HEXACO-60',
                reliability: 0.82
            },
            {
                id: 'hexaco_h2_fairness',
                type: 'likert',
                category: 'honesty_humility',
                facet: 'fairness',
                text: 'If I knew that I could never get caught, I would be willing to steal a million dollars',
                scale: 5,
                scoring: 'reverse',
                instrument: 'HEXACO-60'
            },
            {
                id: 'hexaco_h3_greed_avoidance',
                type: 'likert',
                category: 'honesty_humility',
                facet: 'greed_avoidance',
                text: 'Having a lot of money is not especially important to me',
                scale: 5,
                scoring: 'normal',
                instrument: 'HEXACO-60'
            },
            {
                id: 'hexaco_h4_modesty',
                type: 'likert',
                category: 'honesty_humility',
                facet: 'modesty',
                text: 'I think that I am entitled to more respect than the average person is',
                scale: 5,
                scoring: 'reverse',
                instrument: 'HEXACO-60'
            },

            // === ASRS-5: ADHD SCREENING (6 items) ===
            {
                id: 'asrs_1',
                type: 'frequency',
                category: 'adhd_inattention',
                text: 'How often do you have difficulty concentrating on what people say to you, even when they are speaking to you directly?',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'ASRS-5',
                clinical_weight: 2
            },
            {
                id: 'asrs_2',
                type: 'frequency',
                category: 'adhd_hyperactivity',
                text: 'How often do you leave your seat in meetings or other situations in which you are expected to remain seated?',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'ASRS-5',
                clinical_weight: 2
            },
            {
                id: 'asrs_3',
                type: 'frequency',
                category: 'adhd_inattention',
                text: 'How often do you have difficulty unwinding and relaxing when you have time to yourself?',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'ASRS-5',
                clinical_weight: 3
            },
            {
                id: 'asrs_4',
                type: 'frequency',
                category: 'adhd_hyperactivity',
                text: 'When you\'re in a conversation, how often do you find yourself finishing the sentences of the people you are talking to before they can finish them themselves?',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'ASRS-5',
                clinical_weight: 2
            },
            {
                id: 'asrs_5',
                type: 'frequency',
                category: 'adhd_inattention',
                text: 'How often do you put things off until the last minute?',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'ASRS-5',
                clinical_weight: 3
            },
            {
                id: 'asrs_6',
                type: 'frequency',
                category: 'adhd_hyperactivity',
                text: 'How often do you depend on others to keep your life in order and attend to details?',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'ASRS-5',
                clinical_weight: 2
            },

            // === AQ-10: AUTISM SPECTRUM SCREENING ===
            {
                id: 'aq10_1',
                type: 'likert',
                category: 'asd_social',
                text: 'I often notice small sounds when others do not',
                scale: 4,
                labels: ['Definitely Disagree', 'Slightly Disagree', 'Slightly Agree', 'Definitely Agree'],
                scoring: 'asd_positive',
                instrument: 'AQ-10',
                cutoff_contribution: 1
            },
            {
                id: 'aq10_2',
                type: 'likert',
                category: 'asd_attention',
                text: 'I usually concentrate more on the whole picture, rather than the small details',
                scale: 4,
                labels: ['Definitely Disagree', 'Slightly Disagree', 'Slightly Agree', 'Definitely Agree'],
                scoring: 'asd_negative',
                instrument: 'AQ-10'
            },
            {
                id: 'aq10_3',
                type: 'likert',
                category: 'asd_social',
                text: 'I find it easy to do more than one thing at once',
                scale: 4,
                labels: ['Definitely Disagree', 'Slightly Disagree', 'Slightly Agree', 'Definitely Agree'],
                scoring: 'asd_negative',
                instrument: 'AQ-10'
            },
            {
                id: 'aq10_4',
                type: 'likert',
                category: 'asd_communication',
                text: 'If there is an interruption, I can switch back to what I was doing very quickly',
                scale: 4,
                labels: ['Definitely Disagree', 'Slightly Disagree', 'Slightly Agree', 'Definitely Agree'],
                scoring: 'asd_negative',
                instrument: 'AQ-10'
            },
            {
                id: 'aq10_5',
                type: 'likert',
                category: 'asd_social',
                text: 'I find it easy to "read between the lines" when someone is talking to me',
                scale: 4,
                labels: ['Definitely Disagree', 'Slightly Disagree', 'Slightly Agree', 'Definitely Agree'],
                scoring: 'asd_negative',
                instrument: 'AQ-10'
            },

            // === PSS-10: PERCEIVED STRESS SCALE ===
            {
                id: 'pss_1',
                type: 'frequency',
                category: 'stress_perception',
                text: 'In the last month, how often have you been upset because of something that happened unexpectedly?',
                scale: 5,
                labels: ['Never', 'Almost Never', 'Sometimes', 'Fairly Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'PSS-10',
                timeframe: 'last_month'
            },
            {
                id: 'pss_2',
                type: 'frequency',
                category: 'stress_perception',
                text: 'In the last month, how often have you felt that you were unable to control the important things in your life?',
                scale: 5,
                labels: ['Never', 'Almost Never', 'Sometimes', 'Fairly Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'PSS-10'
            },
            {
                id: 'pss_3',
                type: 'frequency',
                category: 'stress_perception',
                text: 'In the last month, how often have you felt nervous and stressed?',
                scale: 5,
                labels: ['Never', 'Almost Never', 'Sometimes', 'Fairly Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'PSS-10'
            },
            {
                id: 'pss_4',
                type: 'frequency',
                category: 'stress_coping',
                text: 'In the last month, how often have you felt confident about your ability to handle your personal problems?',
                scale: 5,
                labels: ['Never', 'Almost Never', 'Sometimes', 'Fairly Often', 'Very Often'],
                scoring: 'reverse',
                instrument: 'PSS-10'
            },
            {
                id: 'pss_5',
                type: 'frequency',
                category: 'stress_coping',
                text: 'In the last month, how often have you felt that things were going your way?',
                scale: 5,
                labels: ['Never', 'Almost Never', 'Sometimes', 'Fairly Often', 'Very Often'],
                scoring: 'reverse',
                instrument: 'PSS-10'
            },

            // === CD-RISC-10: RESILIENCE SCALE ===
            {
                id: 'cdrisc_1',
                type: 'likert',
                category: 'resilience',
                text: 'I am able to adapt when changes occur',
                scale: 5,
                labels: ['Not True At All', 'Rarely True', 'Sometimes True', 'Often True', 'True Nearly All The Time'],
                scoring: 'normal',
                instrument: 'CD-RISC-10',
                reliability: 0.87
            },
            {
                id: 'cdrisc_2',
                type: 'likert',
                category: 'resilience',
                text: 'I can deal with whatever comes my way',
                scale: 5,
                labels: ['Not True At All', 'Rarely True', 'Sometimes True', 'Often True', 'True Nearly All The Time'],
                scoring: 'normal',
                instrument: 'CD-RISC-10'
            },
            {
                id: 'cdrisc_3',
                type: 'likert',
                category: 'resilience',
                text: 'I try to see the humorous side of things when I am faced with problems',
                scale: 5,
                labels: ['Not True At All', 'Rarely True', 'Sometimes True', 'Often True', 'True Nearly All The Time'],
                scoring: 'normal',
                instrument: 'CD-RISC-10'
            },
            {
                id: 'cdrisc_4',
                type: 'likert',
                category: 'resilience',
                text: 'Having to cope with stress can make me stronger',
                scale: 5,
                labels: ['Not True At All', 'Rarely True', 'Sometimes True', 'Often True', 'True Nearly All The Time'],
                scoring: 'normal',
                instrument: 'CD-RISC-10'
            },
            {
                id: 'cdrisc_5',
                type: 'likert',
                category: 'resilience',
                text: 'I tend to bounce back after illness, injury, or other hardships',
                scale: 5,
                labels: ['Not True At All', 'Rarely True', 'Sometimes True', 'Often True', 'True Nearly All The Time'],
                scoring: 'normal',
                instrument: 'CD-RISC-10'
            }
        ];

        // =====================================
        // TIER 2: COMPREHENSIVE ASSESSMENT
        // =====================================
        
        const comprehensiveAssessmentQuestions = [
            // === SD4: SHORT DARK TETRAD (28 items) ===
            // MACHIAVELLIANISM
            {
                id: 'sd4_m1',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'It\'s not wise to tell your secrets',
                scale: 5,
                labels: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'],
                scoring: 'normal',
                instrument: 'SD4',
                reliability: 0.83
            },
            {
                id: 'sd4_m2',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'I like to use clever manipulation to get my way',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_m3',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'Whatever it takes, you must get the important people on your side',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_m4',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'Avoid direct conflict with others because they may be useful in the future',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_m5',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'It\'s wise to keep track of information that you can use against people later',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_m6',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'You should wait for the right time to get back at people',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_m7',
                type: 'likert',
                category: 'dark_machiavellianism',
                text: 'There are things you should hide from other people to preserve your reputation',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },

            // NARCISSISM
            {
                id: 'sd4_n1',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'People see me as a natural leader',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4',
                reliability: 0.78
            },
            {
                id: 'sd4_n2',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'I hate being the center of attention',
                scale: 5,
                scoring: 'reverse',
                instrument: 'SD4'
            },
            {
                id: 'sd4_n3',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'Many group activities tend to be dull without me',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_n4',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'I know that I am special because everyone keeps telling me so',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_n5',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'I like to get acquainted with important people',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_n6',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'I feel embarrassed if someone compliments me',
                scale: 5,
                scoring: 'reverse',
                instrument: 'SD4'
            },
            {
                id: 'sd4_n7',
                type: 'likert',
                category: 'dark_narcissism',
                text: 'I have been compared to famous people',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },

            // PSYCHOPATHY
            {
                id: 'sd4_p1',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'I like to get revenge on authorities',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4',
                reliability: 0.80
            },
            {
                id: 'sd4_p2',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'I avoid dangerous situations',
                scale: 5,
                scoring: 'reverse',
                instrument: 'SD4'
            },
            {
                id: 'sd4_p3',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'Payback needs to be quick and nasty',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_p4',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'People often say I\'m out of control',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_p5',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'It\'s true that I can be mean to others',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_p6',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'People who mess with me always regret it',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_p7',
                type: 'likert',
                category: 'dark_psychopathy',
                text: 'I have never gotten into trouble with the law',
                scale: 5,
                scoring: 'reverse',
                instrument: 'SD4'
            },

            // SADISM
            {
                id: 'sd4_s1',
                type: 'likert',
                category: 'dark_sadism',
                text: 'I enjoy watching YouTube clips of people fighting',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4',
                reliability: 0.85
            },
            {
                id: 'sd4_s2',
                type: 'likert',
                category: 'dark_sadism',
                text: 'I think about hurting people who irritate me',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_s3',
                type: 'likert',
                category: 'dark_sadism',
                text: 'I would hurt somebody if it meant I would be in control',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_s4',
                type: 'likert',
                category: 'dark_sadism',
                text: 'When I mock someone, it\'s funny to see them get upset',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_s5',
                type: 'likert',
                category: 'dark_sadism',
                text: 'Being mean to others can be exciting',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_s6',
                type: 'likert',
                category: 'dark_sadism',
                text: 'I get pleasure from mocking people in front of their friends',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },
            {
                id: 'sd4_s7',
                type: 'likert',
                category: 'dark_sadism',
                text: 'Watching a fist fight excites me',
                scale: 5,
                scoring: 'normal',
                instrument: 'SD4'
            },

            // === BRIEF-A: EXECUTIVE FUNCTION (Selected Items) ===
            {
                id: 'brief_1_inhibit',
                type: 'frequency',
                category: 'executive_inhibition',
                text: 'I tap my fingers or bounce my legs',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Inhibit'
            },
            {
                id: 'brief_2_shift',
                type: 'frequency',
                category: 'executive_shift',
                text: 'I have trouble changing from one activity or task to another',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Shift'
            },
            {
                id: 'brief_3_emotional',
                type: 'frequency',
                category: 'executive_emotional',
                text: 'I have emotional outbursts for little reason',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Emotional Control'
            },
            {
                id: 'brief_4_initiate',
                type: 'frequency',
                category: 'executive_initiate',
                text: 'I have trouble getting started on tasks',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Initiate'
            },
            {
                id: 'brief_5_working_memory',
                type: 'frequency',
                category: 'executive_memory',
                text: 'I have trouble with jobs or tasks that have more than one step',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Working Memory'
            },
            {
                id: 'brief_6_plan',
                type: 'frequency',
                category: 'executive_planning',
                text: 'I have trouble prioritizing activities',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Plan/Organize'
            },
            {
                id: 'brief_7_monitor',
                type: 'frequency',
                category: 'executive_monitor',
                text: 'I make careless errors when completing tasks',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Task Monitor'
            },
            {
                id: 'brief_8_organization',
                type: 'frequency',
                category: 'executive_organization',
                text: 'My room is a mess',
                scale: 3,
                labels: ['Never', 'Sometimes', 'Often'],
                scoring: 'normal',
                instrument: 'BRIEF-A',
                subscale: 'Organization of Materials'
            },

            // === ERQ: EMOTION REGULATION QUESTIONNAIRE ===
            {
                id: 'erq_1_reappraisal',
                type: 'likert',
                category: 'emotion_reappraisal',
                text: 'When I want to feel more positive emotion, I change what I\'m thinking about',
                scale: 7,
                labels: ['Strongly Disagree', '', '', 'Neutral', '', '', 'Strongly Agree'],
                scoring: 'normal',
                instrument: 'ERQ',
                reliability: 0.79
            },
            {
                id: 'erq_2_reappraisal',
                type: 'likert',
                category: 'emotion_reappraisal',
                text: 'When I want to feel less negative emotion, I change what I\'m thinking about',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_3_reappraisal',
                type: 'likert',
                category: 'emotion_reappraisal',
                text: 'When I\'m faced with a stressful situation, I make myself think about it in a way that helps me stay calm',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_4_reappraisal',
                type: 'likert',
                category: 'emotion_reappraisal',
                text: 'When I want to feel more positive emotion, I change the way I\'m thinking about the situation',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_5_reappraisal',
                type: 'likert',
                category: 'emotion_reappraisal',
                text: 'I control my emotions by changing the way I think about the situation I\'m in',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_6_reappraisal',
                type: 'likert',
                category: 'emotion_reappraisal',
                text: 'When I want to feel less negative emotion, I change the way I\'m thinking about the situation',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_7_suppression',
                type: 'likert',
                category: 'emotion_suppression',
                text: 'I keep my emotions to myself',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ',
                reliability: 0.73
            },
            {
                id: 'erq_8_suppression',
                type: 'likert',
                category: 'emotion_suppression',
                text: 'When I am feeling positive emotions, I am careful not to express them',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_9_suppression',
                type: 'likert',
                category: 'emotion_suppression',
                text: 'I control my emotions by not expressing them',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },
            {
                id: 'erq_10_suppression',
                type: 'likert',
                category: 'emotion_suppression',
                text: 'When I am feeling negative emotions, I make sure not to express them',
                scale: 7,
                scoring: 'normal',
                instrument: 'ERQ'
            },

            // === DERS-16: DIFFICULTIES IN EMOTION REGULATION SCALE ===
            {
                id: 'ders_1_clarity',
                type: 'frequency',
                category: 'emotion_clarity',
                text: 'I have difficulty making sense out of my feelings',
                scale: 5,
                labels: ['Almost Never', 'Sometimes', 'About Half the Time', 'Most of the Time', 'Almost Always'],
                scoring: 'normal',
                instrument: 'DERS-16',
                subscale: 'Clarity'
            },
            {
                id: 'ders_2_goals',
                type: 'frequency',
                category: 'emotion_goals',
                text: 'When I\'m upset, I have difficulty getting work done',
                scale: 5,
                scoring: 'normal',
                instrument: 'DERS-16',
                subscale: 'Goals'
            },
            {
                id: 'ders_3_impulse',
                type: 'frequency',
                category: 'emotion_impulse',
                text: 'When I\'m upset, I become out of control',
                scale: 5,
                scoring: 'normal',
                instrument: 'DERS-16',
                subscale: 'Impulse'
            },
            {
                id: 'ders_4_awareness',
                type: 'frequency',
                category: 'emotion_awareness',
                text: 'I pay attention to how I feel',
                scale: 5,
                scoring: 'reverse',
                instrument: 'DERS-16',
                subscale: 'Awareness'
            },
            {
                id: 'ders_5_strategies',
                type: 'frequency',
                category: 'emotion_strategies',
                text: 'When I\'m upset, I believe that I will remain that way for a long time',
                scale: 5,
                scoring: 'normal',
                instrument: 'DERS-16',
                subscale: 'Strategies'
            },
            {
                id: 'ders_6_nonacceptance',
                type: 'frequency',
                category: 'emotion_nonacceptance',
                text: 'When I\'m upset, I feel ashamed for feeling that way',
                scale: 5,
                scoring: 'normal',
                instrument: 'DERS-16',
                subscale: 'Non-acceptance'
            },

            // === IRI-16: INTERPERSONAL REACTIVITY INDEX (Brief) ===
            {
                id: 'iri_1_perspective',
                type: 'likert',
                category: 'empathy_perspective',
                text: 'I try to look at everybody\'s side of a disagreement before I make a decision',
                scale: 5,
                labels: ['Does not describe me well', '', 'Neutral', '', 'Describes me very well'],
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Perspective Taking',
                reliability: 0.75
            },
            {
                id: 'iri_2_fantasy',
                type: 'likert',
                category: 'empathy_fantasy',
                text: 'I really get involved with the feelings of the characters in a novel',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Fantasy'
            },
            {
                id: 'iri_3_concern',
                type: 'likert',
                category: 'empathy_concern',
                text: 'I often have tender, concerned feelings for people less fortunate than me',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Empathic Concern'
            },
            {
                id: 'iri_4_distress',
                type: 'likert',
                category: 'empathy_distress',
                text: 'In emergency situations, I feel apprehensive and ill-at-ease',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Personal Distress'
            },
            {
                id: 'iri_5_perspective',
                type: 'likert',
                category: 'empathy_perspective',
                text: 'When I\'m upset at someone, I usually try to "put myself in their shoes" for a while',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Perspective Taking'
            },
            {
                id: 'iri_6_fantasy',
                type: 'likert',
                category: 'empathy_fantasy',
                text: 'After seeing a play or movie, I have felt as though I were one of the characters',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Fantasy'
            },
            {
                id: 'iri_7_concern',
                type: 'likert',
                category: 'empathy_concern',
                text: 'When I see someone being taken advantage of, I feel kind of protective towards them',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Empathic Concern'
            },
            {
                id: 'iri_8_distress',
                type: 'likert',
                category: 'empathy_distress',
                text: 'I sometimes feel helpless when I am in the middle of a very emotional situation',
                scale: 5,
                scoring: 'normal',
                instrument: 'IRI-16',
                subscale: 'Personal Distress'
            },

            // === BRIEF COPE (Selected Subscales) ===
            {
                id: 'cope_1_active',
                type: 'frequency',
                category: 'coping_problem',
                text: 'I concentrate my efforts on doing something about the situation I\'m in',
                scale: 4,
                labels: ['I haven\'t been doing this at all', 'A little bit', 'A medium amount', 'I\'ve been doing this a lot'],
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Active Coping'
            },
            {
                id: 'cope_2_planning',
                type: 'frequency',
                category: 'coping_problem',
                text: 'I try to come up with a strategy about what to do',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Planning'
            },
            {
                id: 'cope_3_positive',
                type: 'frequency',
                category: 'coping_emotion',
                text: 'I try to see it in a different light, to make it seem more positive',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Positive Reframing'
            },
            {
                id: 'cope_4_acceptance',
                type: 'frequency',
                category: 'coping_emotion',
                text: 'I accept the reality of the fact that it has happened',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Acceptance'
            },
            {
                id: 'cope_5_humor',
                type: 'frequency',
                category: 'coping_emotion',
                text: 'I make jokes about it',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Humor'
            },
            {
                id: 'cope_6_emotional',
                type: 'frequency',
                category: 'coping_emotion',
                text: 'I get emotional support from others',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Emotional Support'
            },
            {
                id: 'cope_7_denial',
                type: 'frequency',
                category: 'coping_dysfunctional',
                text: 'I refuse to believe that it has happened',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Denial'
            },
            {
                id: 'cope_8_behavioral',
                type: 'frequency',
                category: 'coping_dysfunctional',
                text: 'I give up trying to deal with it',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Behavioral Disengagement'
            },
            {
                id: 'cope_9_venting',
                type: 'frequency',
                category: 'coping_dysfunctional',
                text: 'I express my negative feelings',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Venting'
            },
            {
                id: 'cope_10_self_blame',
                type: 'frequency',
                category: 'coping_dysfunctional',
                text: 'I criticize myself',
                scale: 4,
                scoring: 'normal',
                instrument: 'Brief-COPE',
                subscale: 'Self-Blame'
            }
        ];

        // =====================================
        // TIER 3: SPECIALIZED MODULES
        // =====================================
        
        const specializedModules = {
            // RAADS-R: Detailed Autism Assessment
            autism_detailed: [
                {
                    id: 'raads_1_language',
                    type: 'likert',
                    category: 'asd_language',
                    text: 'I take things too literally, so I often miss what people are trying to say',
                    scale: 4,
                    labels: ['Never True', 'True only when I was younger', 'True only now', 'True now and when I was young'],
                    scoring: 'raads',
                    instrument: 'RAADS-R',
                    domain: 'Language'
                },
                {
                    id: 'raads_2_social',
                    type: 'likert',
                    category: 'asd_social',
                    text: 'I often don\'t know how to act in social situations',
                    scale: 4,
                    scoring: 'raads',
                    instrument: 'RAADS-R',
                    domain: 'Social Relatedness'
                },
                {
                    id: 'raads_3_sensory',
                    type: 'likert',
                    category: 'asd_sensory',
                    text: 'I get extremely upset when the way I like to do things is suddenly changed',
                    scale: 4,
                    scoring: 'raads',
                    instrument: 'RAADS-R',
                    domain: 'Sensory-Motor'
                },
                {
                    id: 'raads_4_interests',
                    type: 'likert',
                    category: 'asd_interests',
                    text: 'I have obsessions that I feel I must do or I will feel very anxious',
                    scale: 4,
                    scoring: 'raads',
                    instrument: 'RAADS-R',
                    domain: 'Circumscribed Interests'
                }
            ],

            // CAT-Q: Camouflaging/Masking Behaviors
            masking: [
                {
                    id: 'catq_1_compensation',
                    type: 'likert',
                    category: 'masking_compensation',
                    text: 'I have developed a script to follow in social situations',
                    scale: 7,
                    labels: ['Strongly Disagree', '', '', 'Neither', '', '', 'Strongly Agree'],
                    scoring: 'normal',
                    instrument: 'CAT-Q',
                    subscale: 'Compensation'
                },
                {
                    id: 'catq_2_masking',
                    type: 'likert',
                    category: 'masking_masking',
                    text: 'I monitor my body language or facial expressions so that I appear relaxed',
                    scale: 7,
                    scoring: 'normal',
                    instrument: 'CAT-Q',
                    subscale: 'Masking'
                },
                {
                    id: 'catq_3_assimilation',
                    type: 'likert',
                    category: 'masking_assimilation',
                    text: 'I feel like I am pretending to be "normal" when I am interacting with others',
                    scale: 7,
                    scoring: 'normal',
                    instrument: 'CAT-Q',
                    subscale: 'Assimilation'
                }
            ],

            // Sensory Processing Profile
            sensory: [
                {
                    id: 'dunn_1_registration',
                    type: 'frequency',
                    category: 'sensory_registration',
                    text: 'I don\'t notice when my name is called',
                    scale: 5,
                    labels: ['Never', 'Seldom', 'Sometimes', 'Frequently', 'Always'],
                    scoring: 'normal',
                    instrument: 'Adult-Sensory-Profile',
                    quadrant: 'Low Registration'
                },
                {
                    id: 'dunn_2_seeking',
                    type: 'frequency',
                    category: 'sensory_seeking',
                    text: 'I add spice to my food',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'Adult-Sensory-Profile',
                    quadrant: 'Sensation Seeking'
                },
                {
                    id: 'dunn_3_sensitivity',
                    type: 'frequency',
                    category: 'sensory_sensitivity',
                    text: 'I startle easily at unexpected or loud noises',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'Adult-Sensory-Profile',
                    quadrant: 'Sensory Sensitivity'
                },
                {
                    id: 'dunn_4_avoiding',
                    type: 'frequency',
                    category: 'sensory_avoiding',
                    text: 'I only eat familiar foods',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'Adult-Sensory-Profile',
                    quadrant: 'Sensation Avoiding'
                },
                {
                    id: 'hsps_1',
                    type: 'likert',
                    category: 'sensory_sensitivity',
                    text: 'I seem to be aware of subtleties in my environment',
                    scale: 7,
                    labels: ['Not at all', '', '', 'Moderately', '', '', 'Extremely'],
                    scoring: 'normal',
                    instrument: 'HSPS-10'
                }
            ],

            // Cognitive Styles
            cognition: [
                {
                    id: 'ncs_1',
                    type: 'likert',
                    category: 'need_cognition',
                    text: 'I would prefer complex to simple problems',
                    scale: 5,
                    labels: ['Extremely Uncharacteristic', 'Somewhat Uncharacteristic', 'Uncertain', 'Somewhat Characteristic', 'Extremely Characteristic'],
                    scoring: 'normal',
                    instrument: 'NCS-6'
                },
                {
                    id: 'crt_1',
                    type: 'problem',
                    category: 'cognitive_reflection',
                    text: 'A bat and a ball cost $1.10 in total. The bat costs $1.00 more than the ball. How much does the ball cost?',
                    intuitive_answer: '10 cents',
                    reflective_answer: '5 cents',
                    instrument: 'CRT'
                },
                {
                    id: 'rei_1_rational',
                    type: 'likert',
                    category: 'thinking_rational',
                    text: 'I enjoy solving problems that require hard thinking',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'REI-40',
                    subscale: 'Rational Engagement'
                },
                {
                    id: 'rei_2_experiential',
                    type: 'likert',
                    category: 'thinking_experiential',
                    text: 'I trust my initial feelings about people',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'REI-40',
                    subscale: 'Experiential Ability'
                }
            ],

            // Mindfulness & Metacognition
            awareness: [
                {
                    id: 'maas_1',
                    type: 'frequency',
                    category: 'mindfulness',
                    text: 'I find myself doing things without paying attention',
                    scale: 6,
                    labels: ['Almost Always', 'Very Frequently', 'Somewhat Frequently', 'Somewhat Infrequently', 'Very Infrequently', 'Almost Never'],
                    scoring: 'reverse',
                    instrument: 'MAAS'
                },
                {
                    id: 'mai_1_knowledge',
                    type: 'likert',
                    category: 'metacognitive_knowledge',
                    text: 'I know when I understand something',
                    scale: 5,
                    labels: ['Never', 'Seldom', 'Sometimes', 'Often', 'Always'],
                    scoring: 'normal',
                    instrument: 'MAI-40'
                },
                {
                    id: 'mai_2_regulation',
                    type: 'likert',
                    category: 'metacognitive_regulation',
                    text: 'I periodically review to help me understand important relationships',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'MAI-40'
                }
            ],

            // Achievement & Motivation
            achievement: [
                {
                    id: 'bpns_1_autonomy',
                    type: 'likert',
                    category: 'needs_autonomy',
                    text: 'I feel like I am free to decide for myself how to live my life',
                    scale: 7,
                    labels: ['Not at all true', '', '', 'Somewhat true', '', '', 'Very true'],
                    scoring: 'normal',
                    instrument: 'BPNS'
                },
                {
                    id: 'bpns_2_competence',
                    type: 'likert',
                    category: 'needs_competence',
                    text: 'Most days I feel a sense of accomplishment from what I do',
                    scale: 7,
                    scoring: 'normal',
                    instrument: 'BPNS'
                },
                {
                    id: 'bpns_3_relatedness',
                    type: 'likert',
                    category: 'needs_relatedness',
                    text: 'I really like the people I interact with',
                    scale: 7,
                    scoring: 'normal',
                    instrument: 'BPNS'
                },
                {
                    id: 'agq_1_mastery_approach',
                    type: 'likert',
                    category: 'goals_mastery',
                    text: 'My aim is to completely master material presented in my classes',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'AGQ-R'
                },
                {
                    id: 'grit_1_perseverance',
                    type: 'likert',
                    category: 'grit',
                    text: 'Setbacks don\'t discourage me',
                    scale: 5,
                    labels: ['Not like me at all', 'Not much like me', 'Somewhat like me', 'Mostly like me', 'Very much like me'],
                    scoring: 'normal',
                    instrument: 'Grit-S'
                }
            ],

            // Alexithymia Assessment
            alexithymia: [
                {
                    id: 'tas_1_identify',
                    type: 'likert',
                    category: 'alexithymia_identify',
                    text: 'I am often confused about what emotion I am feeling',
                    scale: 5,
                    labels: ['Strongly Disagree', 'Disagree', 'Neither', 'Agree', 'Strongly Agree'],
                    scoring: 'normal',
                    instrument: 'TAS-20',
                    subscale: 'Difficulty Identifying Feelings'
                },
                {
                    id: 'tas_2_describe',
                    type: 'likert',
                    category: 'alexithymia_describe',
                    text: 'It is difficult for me to find the right words for my feelings',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'TAS-20',
                    subscale: 'Difficulty Describing Feelings'
                },
                {
                    id: 'tas_3_external',
                    type: 'likert',
                    category: 'alexithymia_external',
                    text: 'I prefer to analyze problems rather than just describe them',
                    scale: 5,
                    scoring: 'reverse',
                    instrument: 'TAS-20',
                    subscale: 'Externally Oriented Thinking'
                }
            ],

            // Decision Making Styles
            decision_making: [
                {
                    id: 'gdms_1_rational',
                    type: 'likert',
                    category: 'decision_rational',
                    text: 'I double-check my information sources to be sure I have the right facts before making decisions',
                    scale: 5,
                    labels: ['Strongly Disagree', 'Disagree', 'Neither', 'Agree', 'Strongly Agree'],
                    scoring: 'normal',
                    instrument: 'GDMS'
                },
                {
                    id: 'gdms_2_intuitive',
                    type: 'likert',
                    category: 'decision_intuitive',
                    text: 'When making decisions, I rely upon my instincts',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'GDMS'
                },
                {
                    id: 'gdms_3_dependent',
                    type: 'likert',
                    category: 'decision_dependent',
                    text: 'I rarely make important decisions without consulting other people',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'GDMS'
                },
                {
                    id: 'gdms_4_avoidant',
                    type: 'likert',
                    category: 'decision_avoidant',
                    text: 'I postpone decision making whenever possible',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'GDMS'
                },
                {
                    id: 'gdms_5_spontaneous',
                    type: 'likert',
                    category: 'decision_spontaneous',
                    text: 'I generally make snap decisions',
                    scale: 5,
                    scoring: 'normal',
                    instrument: 'GDMS'
                }
            ]
        };

        // =====================================
        // EXPERIMENTAL CUTTING-EDGE ASSESSMENTS
        // =====================================
        
        const experimentalAssessments = {
            // Keystroke Dynamics Tracking
            keystrokeDynamics: {
                enabled: false,
                metrics: {
                    dwellTime: [], // How long keys are held
                    flightTime: [], // Time between keystrokes
                    pressure: [], // Key pressure (if available)
                    typingSpeed: 0,
                    rhythmConsistency: 0
                },
                personalityCorrelates: {
                    neuroticism: { dwellTimeVar: 0.26, flightTimeVar: 0.31 },
                    conscientiousness: { typingSpeed: -0.22, consistency: 0.35 },
                    extraversion: { typingSpeed: 0.28, pressure: 0.19 }
                }
            },
            
            // Mouse Movement Patterns
            mouseTracking: {
                enabled: false,
                metrics: {
                    trajectories: [],
                    velocity: [],
                    acceleration: [],
                    clicks: [],
                    scrollPatterns: [],
                    MAD: 0, // Maximum Absolute Deviation
                    AUC: 0 // Area Under Curve
                },
                personalityIndicators: {
                    decisionConflict: 0,
                    impulsivity: 0,
                    exploration: 0
                }
            },
            
            // Digital Biomarkers
            digitalBiomarkers: {
                responseLatency: [],
                questionRevisits: 0,
                backtracking: 0,
                pausePatterns: [],
                engagementScore: 0
            }
        };
        
        // Experimental Assessment Questions
        const experimentalQuestions = [
            // === NONATTACHMENT SCALE (NAS-7) ===
            {
                id: 'nas_1',
                type: 'likert',
                category: 'nonattachment',
                text: 'I can enjoy pleasant experiences without needing them to continue or be repeated',
                scale: 6,
                labels: ['Disagree Strongly', 'Disagree', 'Disagree a little', 'Agree a little', 'Agree', 'Agree Strongly'],
                scoring: 'normal',
                instrument: 'NAS-7',
                domain: 'buddhist_psychology'
            },
            {
                id: 'nas_2',
                type: 'likert',
                category: 'nonattachment',
                text: 'I can accept the flow of events in my life without hanging onto them or pushing them away',
                scale: 6,
                scoring: 'normal',
                instrument: 'NAS-7'
            },
            {
                id: 'nas_3',
                type: 'likert',
                category: 'nonattachment',
                text: 'I can remain open to thoughts and feelings without getting caught up in them',
                scale: 6,
                scoring: 'normal',
                instrument: 'NAS-7'
            },
            {
                id: 'nas_4',
                type: 'likert',
                category: 'nonattachment',
                text: 'When pleasant experiences end, I am fine moving on to what comes next',
                scale: 6,
                scoring: 'normal',
                instrument: 'NAS-7'
            },
            {
                id: 'nas_5',
                type: 'likert',
                category: 'nonattachment',
                text: 'I can let go of regrets and feelings of dissatisfaction about the past',
                scale: 6,
                scoring: 'normal',
                instrument: 'NAS-7'
            },
            {
                id: 'nas_6',
                type: 'likert',
                category: 'nonattachment',
                text: 'When my expectations are not met, I can adapt without getting upset',
                scale: 6,
                scoring: 'normal',
                instrument: 'NAS-7'
            },
            {
                id: 'nas_7',
                type: 'likert',
                category: 'nonattachment',
                text: 'I feel at peace with the impermanent nature of existence',
                scale: 6,
                scoring: 'normal',
                instrument: 'NAS-7'
            },
            
            // === VEDIC PERSONALITY INVENTORY (Gunas) ===
            {
                id: 'vpi_sattva_1',
                type: 'likert',
                category: 'gunas_sattva',
                text: 'I feel content and peaceful most of the time',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always'],
                scoring: 'normal',
                instrument: 'VPI',
                guna: 'sattva'
            },
            {
                id: 'vpi_sattva_2',
                type: 'likert',
                category: 'gunas_sattva',
                text: 'I prefer foods that are fresh, light, and naturally prepared',
                scale: 5,
                scoring: 'normal',
                instrument: 'VPI',
                guna: 'sattva'
            },
            {
                id: 'vpi_rajas_1',
                type: 'likert',
                category: 'gunas_rajas',
                text: 'I am driven by ambition and the desire to achieve',
                scale: 5,
                scoring: 'normal',
                instrument: 'VPI',
                guna: 'rajas'
            },
            {
                id: 'vpi_rajas_2',
                type: 'likert',
                category: 'gunas_rajas',
                text: 'I often feel restless and need to be constantly active',
                scale: 5,
                scoring: 'normal',
                instrument: 'VPI',
                guna: 'rajas'
            },
            {
                id: 'vpi_tamas_1',
                type: 'likert',
                category: 'gunas_tamas',
                text: 'I tend to procrastinate and avoid difficult tasks',
                scale: 5,
                scoring: 'normal',
                instrument: 'VPI',
                guna: 'tamas'
            },
            {
                id: 'vpi_tamas_2',
                type: 'likert',
                category: 'gunas_tamas',
                text: 'I often feel lethargic and lack motivation',
                scale: 5,
                scoring: 'normal',
                instrument: 'VPI',
                guna: 'tamas'
            },
            
            // === UBUNTU SCALE (African Philosophy) ===
            {
                id: 'ubuntu_1',
                type: 'likert',
                category: 'ubuntu',
                text: 'I am who I am because of who we all are',
                scale: 5,
                labels: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'],
                scoring: 'normal',
                instrument: 'Ubuntu-Scale',
                cultural: 'african'
            },
            {
                id: 'ubuntu_2',
                type: 'likert',
                category: 'ubuntu',
                text: 'My well-being is deeply connected to the well-being of my community',
                scale: 5,
                scoring: 'normal',
                instrument: 'Ubuntu-Scale'
            },
            {
                id: 'ubuntu_3',
                type: 'likert',
                category: 'ubuntu',
                text: 'Individual success means nothing if the community suffers',
                scale: 5,
                scoring: 'normal',
                instrument: 'Ubuntu-Scale'
            },
            {
                id: 'ubuntu_4',
                type: 'likert',
                category: 'ubuntu',
                text: 'Harmony in relationships is more important than personal achievement',
                scale: 5,
                scoring: 'normal',
                instrument: 'Ubuntu-Scale'
            },
            
            // === CHINESE PERSONALITY (Face & Guanxi) ===
            {
                id: 'cpai_face_1',
                type: 'likert',
                category: 'chinese_face',
                text: 'I am very concerned about how others perceive my social status',
                scale: 5,
                scoring: 'normal',
                instrument: 'CPAI-Face',
                cultural: 'chinese'
            },
            {
                id: 'cpai_face_2',
                type: 'likert',
                category: 'chinese_face',
                text: 'Losing face in public is one of my greatest fears',
                scale: 5,
                scoring: 'normal',
                instrument: 'CPAI-Face'
            },
            {
                id: 'cpai_guanxi_1',
                type: 'likert',
                category: 'chinese_guanxi',
                text: 'I invest significant time maintaining my social network connections',
                scale: 5,
                scoring: 'normal',
                instrument: 'CPAI-Guanxi'
            },
            {
                id: 'cpai_guanxi_2',
                type: 'likert',
                category: 'chinese_guanxi',
                text: 'Reciprocal obligations in relationships guide many of my decisions',
                scale: 5,
                scoring: 'normal',
                instrument: 'CPAI-Guanxi'
            },
            
            // === ENGAGEMENT WITH BEAUTY SCALE (EBS-R) ===
            {
                id: 'ebs_natural',
                type: 'likert',
                category: 'beauty_natural',
                text: 'I notice and am moved by the beauty of nature',
                scale: 7,
                labels: ['Very Strongly Disagree', 'Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree', 'Very Strongly Agree'],
                scoring: 'normal',
                instrument: 'EBS-R'
            },
            {
                id: 'ebs_artistic',
                type: 'likert',
                category: 'beauty_artistic',
                text: 'I am deeply moved when I see beautiful art',
                scale: 7,
                scoring: 'normal',
                instrument: 'EBS-R'
            },
            {
                id: 'ebs_moral',
                type: 'likert',
                category: 'beauty_moral',
                text: 'I am touched by displays of moral beauty (like acts of virtue or self-sacrifice)',
                scale: 7,
                scoring: 'normal',
                instrument: 'EBS-R'
            },
            {
                id: 'ebs_ideas',
                type: 'likert',
                category: 'beauty_ideas',
                text: 'I experience awe when I encounter beautiful ideas or elegant theories',
                scale: 7,
                scoring: 'normal',
                instrument: 'EBS-R'
            },
            
            // === DARK FACTOR OF PERSONALITY (D16) ===
            {
                id: 'd16_1',
                type: 'likert',
                category: 'dark_factor',
                text: 'I\'ll say anything to get what I want',
                scale: 5,
                labels: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'],
                scoring: 'normal',
                instrument: 'D16'
            },
            {
                id: 'd16_2',
                type: 'likert',
                category: 'dark_factor',
                text: 'It is sometimes worth a little suffering on my part to see others receive the punishment they deserve',
                scale: 5,
                scoring: 'normal',
                instrument: 'D16'
            },
            {
                id: 'd16_3',
                type: 'likert',
                category: 'dark_factor',
                text: 'I know that I am special because everyone keeps telling me so',
                scale: 5,
                scoring: 'normal',
                instrument: 'D16'
            },
            {
                id: 'd16_4',
                type: 'likert',
                category: 'dark_factor',
                text: 'Payback needs to be quick and nasty',
                scale: 5,
                scoring: 'normal',
                instrument: 'D16'
            },
            
            // === FUTURE SELF-CONTINUITY ===
            {
                id: 'fsc_1',
                type: 'visual_scale',
                category: 'future_self',
                text: 'How connected do you feel to your future self 10 years from now?',
                instruction: 'Select the pair of circles that best represents your connection',
                options: [
                    { value: 1, visual: 'â­• â­•', description: 'Completely separate' },
                    { value: 2, visual: 'â­•â­•', description: 'Barely touching' },
                    { value: 3, visual: 'âŠ•', description: 'Slightly overlapping' },
                    { value: 4, visual: 'â—‰', description: 'Moderately overlapping' },
                    { value: 5, visual: 'â—', description: 'Strongly overlapping' },
                    { value: 6, visual: 'â—†', description: 'Mostly overlapping' },
                    { value: 7, visual: 'â– ', description: 'Complete overlap' }
                ],
                instrument: 'FSC'
            },
            {
                id: 'fsc_2',
                type: 'likert',
                category: 'future_self',
                text: 'My future self feels like a stranger to me',
                scale: 7,
                labels: ['Strongly Disagree', '', '', 'Neutral', '', '', 'Strongly Agree'],
                scoring: 'reverse',
                instrument: 'FSC'
            },
            {
                id: 'fsc_3',
                type: 'likert',
                category: 'future_self',
                text: 'I have a vivid image of who I will be in the future',
                scale: 7,
                scoring: 'normal',
                instrument: 'FSC'
            },
            
            // === FLOW PRONENESS ===
            {
                id: 'flow_1',
                type: 'likert',
                category: 'flow_proneness',
                text: 'I often experience moments where I lose track of time while deeply engaged in an activity',
                scale: 5,
                labels: ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'],
                scoring: 'normal',
                instrument: 'GFPS'
            },
            {
                id: 'flow_2',
                type: 'likert',
                category: 'flow_proneness',
                text: 'When doing something I enjoy, the world around me often fades away',
                scale: 5,
                scoring: 'normal',
                instrument: 'GFPS'
            },
            {
                id: 'flow_3',
                type: 'likert',
                category: 'flow_proneness',
                text: 'I naturally seek out activities that perfectly match my skill level',
                scale: 5,
                scoring: 'normal',
                instrument: 'GFPS'
            },
            
            // === PSYCHOLOGICAL FLEXIBILITY ===
            {
                id: 'psyflex_1',
                type: 'likert',
                category: 'psychological_flexibility',
                text: 'I can observe my thoughts and feelings without being controlled by them',
                scale: 7,
                labels: ['Never True', '', '', 'Sometimes True', '', '', 'Always True'],
                scoring: 'normal',
                instrument: 'PsyFlex'
            },
            {
                id: 'psyflex_2',
                type: 'likert',
                category: 'psychological_flexibility',
                text: 'Even when I feel afraid, I can still do what\'s important to me',
                scale: 7,
                scoring: 'normal',
                instrument: 'PsyFlex'
            },
            {
                id: 'psyflex_3',
                type: 'likert',
                category: 'psychological_flexibility',
                text: 'I can stay focused on the present moment even when I\'m anxious',
                scale: 7,
                scoring: 'normal',
                instrument: 'PsyFlex'
            },
            
            // === ANTIFRAGILITY ===
            {
                id: 'antifragile_1',
                type: 'likert',
                category: 'antifragility',
                text: 'I actually become stronger when facing moderate stressors',
                scale: 5,
                labels: ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'],
                scoring: 'normal',
                instrument: 'AFS'
            },
            {
                id: 'antifragile_2',
                type: 'likert',
                category: 'antifragility',
                text: 'Ambiguous situations help me develop new capabilities',
                scale: 5,
                scoring: 'normal',
                instrument: 'AFS'
            },
            {
                id: 'antifragile_3',
                type: 'likert',
                category: 'antifragility',
                text: 'I thrive on volatility and change rather than just surviving it',
                scale: 5,
                scoring: 'normal',
                instrument: 'AFS'
            },
            {
                id: 'antifragile_4',
                type: 'likert',
                category: 'antifragility',
                text: 'Difficulties in specific areas of my life often lead to unexpected gains in other areas',
                scale: 5,
                scoring: 'normal',
                instrument: 'AFS'
            },
            
            // === SITUATIONAL JUDGMENT TESTS ===
            {
                id: 'sjt_1',
                type: 'situational_judgment',
                category: 'judgment_interpersonal',
                text: 'You\'re leading a team project. One talented member consistently delivers excellent work but is difficult to work with and creates tension. What do you do?',
                options: [
                    { text: 'Address the behavior privately, focusing on specific impacts on the team', value: 4, style: 'collaborative' },
                    { text: 'Restructure work to minimize their interaction with others', value: 2, style: 'avoidant' },
                    { text: 'Publicly praise their work while ignoring the behavior', value: 1, style: 'passive' },
                    { text: 'Implement team-building activities to improve dynamics', value: 3, style: 'indirect' }
                ],
                instrument: 'SJT'
            },
            {
                id: 'sjt_2',
                type: 'situational_judgment',
                category: 'judgment_ethical',
                text: 'You discover a close friend has been slightly exaggerating their qualifications on job applications. They ask for your advice. What do you say?',
                options: [
                    { text: 'Encourage them to correct it immediately to maintain integrity', value: 4, style: 'principled' },
                    { text: 'Suggest they stop doing it in future applications', value: 2, style: 'pragmatic' },
                    { text: 'Tell them it\'s their decision and you\'ll support them either way', value: 1, style: 'neutral' },
                    { text: 'Help them reframe their experience honestly but compellingly', value: 3, style: 'constructive' }
                ],
                instrument: 'SJT'
            },
            
            // === FORCED CHOICE ADAPTIVE ===
            {
                id: 'fc_1',
                type: 'forced_choice',
                category: 'forced_choice',
                text: 'Which statement describes you better?',
                options: [
                    { text: 'I prefer working independently on complex problems', trait: 'autonomy', value: 1 },
                    { text: 'I prefer collaborating with others to find solutions', trait: 'collaboration', value: 1 }
                ],
                instrument: 'MUPP'
            },
            {
                id: 'fc_2',
                type: 'forced_choice',
                category: 'forced_choice',
                text: 'Which approach resonates more with you?',
                options: [
                    { text: 'Planning thoroughly before taking action', trait: 'deliberation', value: 1 },
                    { text: 'Adapting quickly as situations unfold', trait: 'flexibility', value: 1 }
                ],
                instrument: 'MUPP'
            },
            {
                id: 'fc_3',
                type: 'forced_choice',
                category: 'forced_choice',
                text: 'In relationships, I value more:',
                options: [
                    { text: 'Deep connections with a few people', trait: 'depth', value: 1 },
                    { text: 'Diverse connections with many people', trait: 'breadth', value: 1 }
                ],
                instrument: 'MUPP'
            },
            
            // === IMPLICIT ASSOCIATION STYLE QUESTIONS ===
            {
                id: 'iat_1',
                type: 'rapid_association',
                category: 'implicit_self',
                text: 'First word that comes to mind when you think of yourself:',
                instruction: 'Respond as quickly as possible without overthinking',
                freeResponse: true,
                timeLimit: 5000,
                instrument: 'IAT-Style'
            },
            {
                id: 'iat_2',
                type: 'word_association',
                category: 'implicit_values',
                text: 'Which word pair feels more naturally connected to you?',
                pairs: [
                    { pair: ['Success', 'Happiness'], value: 'achievement' },
                    { pair: ['Peace', 'Contentment'], value: 'harmony' },
                    { pair: ['Growth', 'Challenge'], value: 'development' },
                    { pair: ['Security', 'Stability'], value: 'safety' }
                ],
                responseTime: true,
                instrument: 'IAT-Style'
            }
        ];
        
        // Combine questions based on assessment mode and tier
        let assessmentQuestions = [];
        
        // Use enhanced question formats when available
        if (window.questionIntegration) {
            if (assessmentConfig.mode === 'experimental') {
                // Use enhanced experimental questions
                assessmentQuestions = window.questionIntegration.transformExperimental();
                assessmentConfig.biometricTracking = true;
            } else {
                // Use enhanced validated questions
                assessmentQuestions = window.questionIntegration.transformValidated();
                
                // Add more questions based on tier
                if (assessmentConfig.currentTier === 'comprehensive') {
                    assessmentQuestions = [...assessmentQuestions, ...comprehensiveAssessmentQuestions.slice(0, 10)];
                } else if (assessmentConfig.currentTier === 'specialized') {
                    assessmentQuestions = [...assessmentQuestions, ...Object.values(specializedModules).flat().slice(0, 15)];
                }
            }
        } else {
            // Fallback to original questions if enhancement not loaded
            if (assessmentConfig.mode === 'experimental') {
                assessmentQuestions = experimentalQuestions;
                assessmentConfig.biometricTracking = true;
            } else {
                if (assessmentConfig.currentTier === 'core') {
                    assessmentQuestions = coreScreeningQuestions;
                } else if (assessmentConfig.currentTier === 'comprehensive') {
                    assessmentQuestions = [...coreScreeningQuestions, ...comprehensiveAssessmentQuestions];
                } else if (assessmentConfig.currentTier === 'specialized') {
                    assessmentQuestions = [
                        ...coreScreeningQuestions,
                        ...comprehensiveAssessmentQuestions,
                        ...Object.values(specializedModules).flat()
                    ];
                }
            }
        }

        // Legacy compatibility - keep some original creative questions for transition
        const creativeQuestions = [
            // Cognitive Processing Style
            {
                id: 'cognitive_style',
                type: 'scenario',
                category: 'cognitive_processing',
                text: 'You need to make an important decision. What\'s your first instinct?',
                instruction: 'Think about how you naturally approach complex choices',
                options: [
                    { text: 'Trust my gut feeling immediately', value: 7, trait: 'intuitive' },
                    { text: 'Quick mental pros/cons, then decide', value: 5, trait: 'balanced' },
                    { text: 'Research thoroughly before choosing', value: 3, trait: 'analytical' },
                    { text: 'Ask trusted people for their input', value: 4, trait: 'social' }
                ],
                research: 'System 1/2 thinking (Kahneman, 2011)'
            },
            
            // Social Energy Patterns (NEO-PI-R Extraversion Facets)
            {
                id: 'social_energy',
                type: 'slider',
                category: 'extraversion',
                text: 'After intense social interaction, your energy feels...',
                instruction: 'Think about how you feel after a busy social event',
                min: 1,
                max: 7,
                labels: ['Completely depleted', 'Balanced', 'Fully recharged'],
                research: 'Extraversion energy hypothesis (Lucas et al., 2000)'
            },
            
            // Behavioral Activation System (Gray's BIS/BAS)
            {
                id: 'reward_sensitivity',
                type: 'scenario',
                category: 'extraversion',
                text: 'You see an opportunity that excites you but has risks. You:',
                instruction: 'Consider your typical response to exciting possibilities',
                options: [
                    { text: 'Jump in immediately - the excitement is worth it!', value: 7, trait: 'high_BAS' },
                    { text: 'Feel excited but need time to consider', value: 5, trait: 'moderate_BAS' },
                    { text: 'Carefully weigh all risks first', value: 3, trait: 'high_BIS' },
                    { text: 'Usually pass - not worth the potential downsides', value: 1, trait: 'avoidant' }
                ],
                research: 'BIS/BAS scales (Carver & White, 1994)'
            },
            
            // Social Processing Speed (Based on social cognition research)
            {
                id: 'social_processing',
                type: 'visual_grid',
                category: 'extraversion',
                text: 'In group conversations, which describes you best?',
                options: [
                    { emoji: 'ðŸ’­', text: 'Think first', value: 'internal_processing' },
                    { emoji: 'ðŸ—£ï¸', text: 'Think aloud', value: 'external_processing' },
                    { emoji: 'ðŸ‘‚', text: 'Listen mostly', value: 'receptive' },
                    { emoji: 'ðŸŽ¯', text: 'Direct flow', value: 'leadership' },
                    { emoji: 'ðŸ”„', text: 'Adapt quickly', value: 'flexible' },
                    { emoji: 'â¸ï¸', text: 'Need pauses', value: 'reflective' }
                ],
                multiSelect: false,
                research: 'Social information processing (Crick & Dodge, 1994)'
            },
            
            // Big Five: Openness
            {
                id: 'ocean_o1',
                type: 'scenario',
                category: 'openness',
                text: 'You discover a hidden door in your home. Your first instinct is to:',
                options: [
                    { text: 'Immediately explore every corner', value: 7 },
                    { text: 'Cautiously investigate', value: 5 },
                    { text: 'Research the house history first', value: 4 },
                    { text: 'Call someone else to check', value: 2 }
                ]
            },
            {
                id: 'ocean_o2',
                type: 'visual_grid',
                category: 'openness',
                text: 'Which activities appeal to you most? Select all:',
                options: [
                    { emoji: 'ðŸŽ¨', text: 'Art/Creating', value: 'creative' },
                    { emoji: 'ðŸ“š', text: 'Philosophy', value: 'abstract' },
                    { emoji: 'ðŸ—ºï¸', text: 'Exploring', value: 'adventure' },
                    { emoji: 'ðŸ”¬', text: 'Experimenting', value: 'curious' },
                    { emoji: 'ðŸŽ­', text: 'Performing', value: 'expressive' },
                    { emoji: 'ðŸ§©', text: 'Puzzles', value: 'analytical' },
                    { emoji: 'ðŸ“–', text: 'Stories', value: 'imaginative' },
                    { emoji: 'ðŸ›ï¸', text: 'History', value: 'traditional' }
                ],
                multiSelect: true
            },
            {
                id: 'ocean_o3',
                type: 'slider',
                category: 'openness',
                text: 'How comfortable are you with ambiguity and uncertainty?',
                min: 1,
                max: 7,
                labels: ['Very uncomfortable', 'Neutral', 'Very comfortable']
            },
            
            // Big Five: Conscientiousness
            {
                id: 'ocean_c1',
                type: 'time_preference',
                category: 'conscientiousness',
                text: 'When do you typically arrive for appointments?',
                options: [
                    { text: '15+ min early', value: 7, icon: 'â°' },
                    { text: '5-10 min early', value: 6, icon: 'âœ…' },
                    { text: 'Exactly on time', value: 5, icon: 'ðŸŽ¯' },
                    { text: '5 min late', value: 3, icon: 'ðŸ˜…' },
                    { text: 'Time is fluid', value: 1, icon: 'ðŸŒŠ' }
                ]
            },
            {
                id: 'ocean_c2',
                type: 'scenario',
                category: 'conscientiousness',
                text: 'Your workspace typically looks like:',
                options: [
                    { text: 'Everything has its exact place', value: 7 },
                    { text: 'Generally organized with some clutter', value: 5 },
                    { text: 'Organized chaos - I know where things are', value: 3 },
                    { text: 'Free-form creative space', value: 1 }
                ]
            },
            {
                id: 'ocean_c3',
                type: 'slider',
                category: 'conscientiousness',
                text: 'How closely do you follow through on plans you make?',
                min: 1,
                max: 7,
                labels: ['Rarely follow through', 'Sometimes', 'Always complete']
            },
            
            // Big Five: Agreeableness
            {
                id: 'ocean_a1',
                type: 'scenario',
                category: 'agreeableness',
                text: 'A stranger asks for help with directions. You:',
                options: [
                    { text: 'Walk them to their destination', value: 7 },
                    { text: 'Give detailed directions with alternatives', value: 6 },
                    { text: 'Point them in the general direction', value: 4 },
                    { text: 'Say you\'re too busy to help', value: 2 }
                ]
            },
            {
                id: 'ocean_a2',
                type: 'slider',
                category: 'agreeableness',
                text: 'In conflicts, you tend to:',
                min: 1,
                max: 7,
                labels: ['Stand your ground firmly', 'Seek middle ground', 'Avoid at all costs']
            },
            {
                id: 'ocean_a3',
                type: 'visual_grid',
                category: 'agreeableness',
                text: 'How do you typically respond to others\' success?',
                options: [
                    { emoji: 'ðŸŽ‰', text: 'Celebrate', value: 'supportive' },
                    { emoji: 'ðŸ‘', text: 'Congratulate', value: 'positive' },
                    { emoji: 'ðŸ˜', text: 'Neutral', value: 'indifferent' },
                    { emoji: 'ðŸ¤”', text: 'Analyze', value: 'comparative' },
                    { emoji: 'ðŸ˜¤', text: 'Competitive', value: 'motivated' },
                    { emoji: 'ðŸ˜’', text: 'Skeptical', value: 'critical' }
                ],
                multiSelect: false
            },
            
            // Big Five: Neuroticism
            {
                id: 'ocean_n1',
                type: 'slider',
                category: 'neuroticism',
                text: 'How often do you worry about things beyond your control?',
                min: 1,
                max: 7,
                labels: ['Never', 'Sometimes', 'Constantly']
            },
            {
                id: 'ocean_n2',
                type: 'scenario',
                category: 'neuroticism',
                text: 'You make a minor mistake at work. Your reaction:',
                options: [
                    { text: 'Laugh it off and move on', value: 1 },
                    { text: 'Fix it and forget about it', value: 3 },
                    { text: 'Feel embarrassed for a while', value: 5 },
                    { text: 'Replay it in your mind for days', value: 7 }
                ]
            },
            {
                id: 'ocean_n3',
                type: 'frequency_grid',
                category: 'neuroticism',
                text: 'How often do you experience these?',
                items: [
                    'Mood swings',
                    'Anxiety about future',
                    'Self-doubt',
                    'Emotional overwhelm'
                ],
                scale: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always']
            },
            
            // HEXACO: Honesty-Humility
            {
                id: 'hexaco_h1',
                type: 'scenario',
                category: 'honesty_humility',
                text: 'You find a wallet with $500 cash. You:',
                options: [
                    { text: 'Return everything immediately', value: 7 },
                    { text: 'Return wallet, consider keeping some cash', value: 4 },
                    { text: 'Keep the cash, return the wallet', value: 2 },
                    { text: 'Keep everything', value: 1 }
                ]
            },
            {
                id: 'hexaco_h2',
                type: 'slider',
                category: 'honesty_humility',
                text: 'How comfortable are you with self-promotion?',
                min: 1,
                max: 7,
                labels: ['Very uncomfortable', 'Balanced', 'Very comfortable']
            },
            
            // Neurodiversity: ADHD
            {
                id: 'adhd_1',
                type: 'frequency_grid',
                category: 'adhd_attention',
                text: 'How often do these happen to you?',
                items: [
                    'Start projects without finishing',
                    'Lose track of time when engaged',
                    'Forget appointments',
                    'Difficulty sitting still',
                    'Interrupt others'
                ],
                scale: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always']
            },
            {
                id: 'adhd_2',
                type: 'scenario',
                category: 'adhd_hyperactivity',
                text: 'During a long meeting, you:',
                options: [
                    { text: 'Sit still and focus throughout', value: 1 },
                    { text: 'Fidget a little but stay engaged', value: 3 },
                    { text: 'Need to move, doodle, or fidget constantly', value: 5 },
                    { text: 'Feel like you might explode if you can\'t move', value: 7 }
                ]
            },
            
            // Neurodiversity: Autism Spectrum
            {
                id: 'asd_1',
                type: 'scenario',
                category: 'asd_social',
                text: 'At a work gathering, a colleague makes a joke everyone laughs at. You:',
                options: [
                    { text: 'Laugh naturally', value: 1 },
                    { text: 'Smile because others are', value: 3 },
                    { text: 'Analyze why it\'s funny', value: 5 },
                    { text: 'Feel confused but pretend', value: 7 }
                ]
            },
            {
                id: 'asd_2',
                type: 'visual_grid',
                category: 'asd_sensory',
                text: 'Which sensory experiences bother you? Select all:',
                options: [
                    { emoji: 'ðŸ”Š', text: 'Loud noises', value: 'auditory' },
                    { emoji: 'ðŸ’¡', text: 'Bright lights', value: 'visual' },
                    { emoji: 'ðŸ‘•', text: 'Clothing tags', value: 'tactile' },
                    { emoji: 'ðŸ½ï¸', text: 'Food textures', value: 'oral' },
                    { emoji: 'ðŸ‘ƒ', text: 'Strong smells', value: 'olfactory' },
                    { emoji: 'ðŸƒ', text: 'Sudden movement', value: 'vestibular' }
                ],
                multiSelect: true
            },
            {
                id: 'asd_3',
                type: 'slider',
                category: 'asd_routine',
                text: 'How do you feel when your routine is disrupted?',
                min: 1,
                max: 7,
                labels: ['Totally fine', 'Slightly bothered', 'Very distressed']
            },
            
            // High Sensitivity
            {
                id: 'hsp_1',
                type: 'slider',
                category: 'sensitivity',
                text: 'How intensely do you experience emotions compared to others?',
                min: 1,
                max: 10,
                labels: ['Much less', 'Similar', 'Much more']
            },
            {
                id: 'hsp_2',
                type: 'scenario',
                category: 'sensitivity',
                text: 'After a busy, stimulating day, you need:',
                options: [
                    { text: 'More stimulation - go out!', value: 1 },
                    { text: 'A quiet evening with friends', value: 3 },
                    { text: 'Complete solitude and darkness', value: 5 },
                    { text: 'Days to fully recover', value: 7 }
                ]
            },
            
            // Executive Function
            {
                id: 'ef_1',
                type: 'task_ranking',
                category: 'executive_function',
                text: 'Rank these from easiest to hardest:',
                items: [
                    'Starting projects',
                    'Finishing projects',
                    'Task switching',
                    'Organizing workspace',
                    'Following schedule'
                ]
            },
            {
                id: 'ef_2',
                type: 'frequency_grid',
                category: 'executive_function',
                text: 'How often do you struggle with:',
                items: [
                    'Prioritizing tasks',
                    'Time management',
                    'Decision making',
                    'Working memory'
                ],
                scale: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always']
            },
            
            // Stress Response
            {
                id: 'stress_1',
                type: 'body_mapping',
                category: 'stress_response',
                text: 'Where do you typically feel stress in your body?',
                areas: ['head', 'neck', 'shoulders', 'chest', 'stomach', 'back', 'limbs']
            },
            {
                id: 'stress_2',
                type: 'scenario',
                category: 'stress_response',
                text: 'Under pressure, you tend to:',
                options: [
                    { text: 'Become hyper-focused and productive', value: 'active' },
                    { text: 'Feel energized but scattered', value: 'anxious' },
                    { text: 'Withdraw and need space', value: 'avoidant' },
                    { text: 'Seek support from others', value: 'social' }
                ]
            },
            
            // Values & Motivation
            {
                id: 'values_1',
                type: 'scenario',
                category: 'values',
                text: 'Which would you choose?',
                options: [
                    { text: 'High-paying job you dislike', value: 'security' },
                    { text: 'Lower-paying job you love', value: 'passion' }
                ]
            },
            {
                id: 'values_2',
                type: 'visual_grid',
                category: 'values',
                text: 'What motivates you most? Choose top 3:',
                options: [
                    { emoji: 'ðŸ†', text: 'Achievement', value: 'achievement' },
                    { emoji: 'â¤ï¸', text: 'Relationships', value: 'connection' },
                    { emoji: 'ðŸŽ¯', text: 'Growth', value: 'growth' },
                    { emoji: 'ðŸ›¡ï¸', text: 'Security', value: 'security' },
                    { emoji: 'ðŸŽ¨', text: 'Creativity', value: 'creativity' },
                    { emoji: 'âš–ï¸', text: 'Justice', value: 'justice' },
                    { emoji: 'ðŸŒŸ', text: 'Recognition', value: 'recognition' },
                    { emoji: 'ðŸ•Šï¸', text: 'Peace', value: 'harmony' }
                ],
                multiSelect: true,
                maxSelect: 3
            }
        ];

        // Initialize assessment system
        let currentQuestionIndex = 0;
        let responses = {};
        let startTime = null;

        // Mode selection handler
        function updateModeSelection() {
            const mode = document.querySelector('input[name="assessmentMode"]:checked').value;
            assessmentConfig.mode = mode;
            
            const tierSelection = document.getElementById('tierSelection');
            const timeEstimate = document.getElementById('timeEstimate');
            
            if (mode === 'experimental') {
                tierSelection.style.display = 'none';
                timeEstimate.textContent = 'Estimated time: 30-40 minutes';
            } else {
                tierSelection.style.display = 'block';
                updateTierSelection();
            }
        }

        // Tier selection handler
        function updateTierSelection() {
            const tier = document.getElementById('assessmentTier').value;
            assessmentConfig.currentTier = tier;
            
            const timeEstimate = document.getElementById('timeEstimate');
            switch(tier) {
                case 'core':
                    timeEstimate.textContent = 'Estimated time: 20-25 minutes';
                    break;
                case 'comprehensive':
                    timeEstimate.textContent = 'Estimated time: 45-60 minutes';
                    break;
                case 'specialized':
                    timeEstimate.textContent = 'Estimated time: 60+ minutes';
                    break;
            }
        }

        // Add event listener for tier selection
        document.addEventListener('DOMContentLoaded', function() {
            const tierSelect = document.getElementById('assessmentTier');
            if (tierSelect) {
                tierSelect.addEventListener('change', updateTierSelection);
            }
        });
        let questionStartTime = null;
        let timeElapsedInterval = null;
        let progressMinimized = false;
        
        // Toggle progress panel
        function toggleProgress() {
            const container = document.getElementById('progressContainer');
            const toggleText = document.getElementById('toggleText');
            
            progressMinimized = !progressMinimized;
            
            if (progressMinimized) {
                container.classList.add('minimized');
                toggleText.textContent = 'Show';
            } else {
                container.classList.remove('minimized');
                toggleText.textContent = 'Hide';
            }
            
            // Save preference to localStorage
            localStorage.setItem('progressMinimized', progressMinimized);
        }
        
        // Restore progress panel state on load
        function restoreProgressState() {
            const saved = localStorage.getItem('progressMinimized');
            if (saved === 'true') {
                progressMinimized = true;
                const container = document.getElementById('progressContainer');
                const toggleText = document.getElementById('toggleText');
                container.classList.add('minimized');
                toggleText.textContent = 'Show';
            }
        }
        let userProfile = null;

        // Initialize neural network background
        function initNeuralBackground() {
            const canvas = document.getElementById('neuralCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const nodes = [];
            const nodeCount = 50;
            
            for (let i = 0; i < nodeCount; i++) {
                nodes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 2 + 1
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                nodes.forEach(node => {
                    node.x += node.vx;
                    node.y += node.vy;
                    
                    if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
                    if (node.y < 0 || node.y > canvas.height) node.vy *= -1;
                });
                
                ctx.strokeStyle = 'rgba(74, 144, 226, 0.1)';
                ctx.lineWidth = 1;
                
                nodes.forEach((node1, i) => {
                    nodes.slice(i + 1).forEach(node2 => {
                        const distance = Math.hypot(node1.x - node2.x, node1.y - node2.y);
                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.moveTo(node1.x, node1.y);
                            ctx.lineTo(node2.x, node2.y);
                            ctx.stroke();
                        }
                    });
                });
                
                ctx.fillStyle = 'rgba(74, 144, 226, 0.3)';
                nodes.forEach(node => {
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', function() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', newTheme);
            this.querySelector('.theme-icon').textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ðŸŒ™';
            localStorage.setItem('theme', newTheme);
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.querySelector('.theme-icon').textContent = savedTheme === 'light' ? 'â˜€ï¸' : 'ðŸŒ™';

        // Select assessment mode
        function selectMode(mode) {
            assessmentConfig.mode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById(`mode-${mode}`).classList.add('selected');
            
            // Update button text
            const startBtn = document.querySelector('#welcomeScreen .btn-primary span');
            if (startBtn) {
                startBtn.textContent = mode === 'experimental' ? 'Begin Experimental Assessment' : 'Begin Validated Assessment';
            }
            
            // Update question set with enhanced formats
            if (window.questionIntegration) {
                if (mode === 'experimental') {
                    assessmentQuestions = window.questionIntegration.transformExperimental();
                    assessmentConfig.biometricTracking = true;
                } else {
                    assessmentQuestions = window.questionIntegration.transformValidated();
                    assessmentConfig.biometricTracking = false;
                    
                    // Add more questions based on tier
                    if (assessmentConfig.currentTier === 'comprehensive') {
                        assessmentQuestions = [...assessmentQuestions, ...comprehensiveAssessmentQuestions.slice(0, 10)];
                    } else if (assessmentConfig.currentTier === 'specialized') {
                        assessmentQuestions = [...assessmentQuestions, ...Object.values(specializedModules).flat().slice(0, 15)];
                    }
                }
            } else {
                // Fallback to original questions
                if (mode === 'experimental') {
                    assessmentQuestions = experimentalQuestions;
                    assessmentConfig.biometricTracking = true;
                } else {
                    if (assessmentConfig.currentTier === 'core') {
                        assessmentQuestions = coreScreeningQuestions;
                    } else if (assessmentConfig.currentTier === 'comprehensive') {
                        assessmentQuestions = [...coreScreeningQuestions, ...comprehensiveAssessmentQuestions];
                    } else if (assessmentConfig.currentTier === 'specialized') {
                        assessmentQuestions = [
                            ...coreScreeningQuestions,
                            ...comprehensiveAssessmentQuestions,
                            ...Object.values(specializedModules).flat()
                        ];
                    }
                    assessmentConfig.biometricTracking = false;
                }
            }
        }
        
        // Start assessment
        function startAssessment() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('assessmentContainer').style.display = 'block';
            document.getElementById('progressContainer').style.display = 'block';
            restoreProgressState();
            
            startTime = Date.now();
            questionStartTime = Date.now();
            
            document.getElementById('totalQuestions').textContent = assessmentQuestions.length;
            
            timeElapsedInterval = setInterval(updateTimeElapsed, 1000);
            
            // Initialize biometric tracking if experimental mode
            if (assessmentConfig.mode === 'experimental' && assessmentConfig.biometricTracking) {
                initializeBiometricTracking();
            }
            
            showQuestion(0);
        }

        // Update time elapsed
        function updateTimeElapsed() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timeElapsed').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Show question
        function showQuestion(index) {
            if (index >= assessmentQuestions.length) {
                completeAssessment();
                return;
            }
            
            currentQuestionIndex = index;
            const question = assessmentQuestions[index];
            
            updateProgress();
            
            const container = document.getElementById('assessmentContainer');
            
            // Check if we're using enhanced renderer
            if (window.questionIntegration && window.questionIntegration.renderEnhanced) {
                // Enhanced renderer handles DOM directly
                renderQuestion(question);
            } else {
                // Original renderer returns HTML string
                container.innerHTML = renderQuestion(question);
            }
            
            initializeQuestionInteractions(question);
        }

        // Update progress
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / assessmentQuestions.length) * 100;
            const progressBar = document.getElementById('progressBar');
            const questionNumber = document.getElementById('questionNumber');
            const completionRate = document.getElementById('completionRate');
            
            if (progressBar) progressBar.style.width = `${progress}%`;
            if (questionNumber) questionNumber.textContent = currentQuestionIndex + 1;
            if (completionRate) completionRate.textContent = `${Math.round(progress)}%`;
        }

        // Render question based on type
        function renderQuestion(question) {
            // Use enhanced renderer if available
            if (window.questionIntegration && window.questionIntegration.renderEnhanced) {
                const container = window.questionIntegration.renderEnhanced(question);
                const assessmentContainer = document.getElementById('assessmentContainer');
                if (assessmentContainer) {
                    assessmentContainer.innerHTML = '';
                    assessmentContainer.appendChild(container);
                    
                    // Add navigation buttons
                    const navDiv = document.createElement('div');
                    navDiv.className = 'question-navigation';
                    navDiv.innerHTML = `
                        <button class="btn btn-secondary" onclick="previousQuestion()" ${currentQuestionIndex === 0 ? 'disabled' : ''}>
                            Previous
                        </button>
                        <button class="btn btn-primary" onclick="nextQuestion()">
                            ${currentQuestionIndex === assessmentQuestions.length - 1 ? 'Complete' : 'Next'}
                        </button>
                    `;
                    assessmentContainer.appendChild(navDiv);
                }
                
                // Update progress display
                const questionNumber = document.getElementById('questionNumber');
                if (questionNumber) {
                    questionNumber.textContent = currentQuestionIndex + 1;
                }
                updateProgress();
                return;
            }
            
            // Fallback to original renderer
            let html = `
                <div class="assessment-card">
                    <div class="question-header">
                        <div class="question-number">
                            <span>Question ${currentQuestionIndex + 1}</span>
                            <span>of ${assessmentQuestions.length}</span>
                        </div>
                        <div class="question-category">${question.category.replace(/_/g, ' ')}</div>
                    </div>
                    <div class="question-text">${question.text || question.prompt}</div>
                    ${question.instruction ? `<div class="question-instruction">${question.instruction}</div>` : ''}
                    <div class="question-content">
            `;
            
            switch(question.type) {
                case 'likert':
                    html += renderLikert(question);
                    break;
                case 'frequency':
                    html += renderFrequency(question);
                    break;
                case 'visual_grid':
                    html += renderVisualGrid(question);
                    break;
                case 'slider':
                    html += renderSlider(question);
                    break;
                case 'scenario':
                    html += renderScenario(question);
                    break;
                case 'frequency_grid':
                    html += renderFrequencyGrid(question);
                    break;
                case 'time_preference':
                    html += renderTimePreference(question);
                    break;
                case 'task_ranking':
                    html += renderTaskRanking(question);
                    break;
                case 'body_mapping':
                    html += renderBodyMapping(question);
                    break;
                case 'problem':
                    html += renderProblem(question);
                    break;
                case 'situational_judgment':
                    html += renderSituationalJudgment(question);
                    break;
                case 'forced_choice':
                    html += renderForcedChoice(question);
                    break;
                case 'visual_scale':
                    html += renderVisualScale(question);
                    break;
                case 'rapid_association':
                    html += renderRapidAssociation(question);
                    break;
                case 'word_association':
                    html += renderWordAssociation(question);
                    break;
                default:
                    html += renderLikert(question); // Default to Likert for most validated instruments
            }
            
            html += `
                    </div>
                    <div class="btn-group">
                        ${currentQuestionIndex > 0 ? '<button class="btn btn-secondary" onclick="previousQuestion()">â† Previous</button>' : ''}
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">
                            ${currentQuestionIndex === assessmentQuestions.length - 1 ? 'Complete Assessment' : 'Next â†’'}
                        </button>
                    </div>
                </div>
            `;
            
            return html;
        }

        // Question type renderers
        
        // Render Likert scale questions (most common type for validated instruments)
        function renderLikert(question) {
            const scale = question.scale || 5;
            const labels = question.labels || ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'];
            
            let html = '<div class="likert-scale">';
            
            // Add scale labels if they exist
            if (labels.length === scale) {
                html += '<div class="likert-labels">';
                labels.forEach((label, i) => {
                    html += `<span class="likert-label">${label}</span>`;
                });
                html += '</div>';
            }
            
            // Add radio buttons
            html += '<div class="likert-options">';
            for (let i = 1; i <= scale; i++) {
                const id = `${question.id}_${i}`;
                html += `
                    <div class="likert-option">
                        <input type="radio" id="${id}" name="${question.id}" value="${i}" class="likert-radio">
                        <label for="${id}" class="likert-button">
                            ${labels.length === 2 ? (i === 1 ? labels[0] : i === scale ? labels[1] : i) : i}
                        </label>
                    </div>
                `;
            }
            html += '</div>';
            
            // Add instrument info if available
            if (question.instrument) {
                html += `<div class="instrument-info">Source: ${question.instrument}</div>`;
            }
            
            html += '</div>';
            return html;
        }
        
        // Render frequency questions
        function renderFrequency(question) {
            const labels = question.labels || ['Never', 'Rarely', 'Sometimes', 'Often', 'Very Often'];
            
            let html = '<div class="frequency-scale">';
            labels.forEach((label, i) => {
                const id = `${question.id}_${i}`;
                html += `
                    <div class="frequency-option-single">
                        <input type="radio" id="${id}" name="${question.id}" value="${label}" class="frequency-radio">
                        <label for="${id}" class="frequency-button">
                            ${label}
                        </label>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }
        
        // Render problem-solving questions (like CRT)
        function renderProblem(question) {
            return `
                <div class="problem-container">
                    <div class="problem-text">${question.text}</div>
                    <input type="text" class="problem-input" id="${question.id}_input" placeholder="Enter your answer">
                    <div class="problem-hint">Think carefully before answering</div>
                </div>
            `;
        }
        
        // Render situational judgment tests
        function renderSituationalJudgment(question) {
            let html = '<div class="situational-judgment">';
            html += `<div class="situation-context">${question.text}</div>`;
            html += '<div class="judgment-options">';
            
            question.options.forEach((option, i) => {
                const id = `${question.id}_${i}`;
                html += `
                    <div class="judgment-option">
                        <input type="radio" id="${id}" name="${question.id}" value="${i}" class="judgment-radio">
                        <label for="${id}" class="judgment-label">
                            <span class="judgment-text">${option.text}</span>
                            ${option.style ? `<span class="judgment-style">${option.style}</span>` : ''}
                        </label>
                    </div>
                `;
            });
            
            html += '</div></div>';
            return html;
        }
        
        // Render forced choice questions
        function renderForcedChoice(question) {
            let html = '<div class="forced-choice">';
            html += `<div class="forced-prompt">${question.text}</div>`;
            html += '<div class="forced-options">';
            
            question.options.forEach((option, i) => {
                const id = `${question.id}_${i}`;
                html += `
                    <div class="forced-option">
                        <input type="radio" id="${id}" name="${question.id}" value="${i}" class="forced-radio">
                        <label for="${id}" class="forced-button">
                            ${option.text}
                        </label>
                    </div>
                `;
            });
            
            html += '</div></div>';
            return html;
        }
        
        // Render visual scale (like Future Self-Continuity)
        function renderVisualScale(question) {
            let html = '<div class="visual-scale">';
            if (question.instruction) {
                html += `<div class="visual-instruction">${question.instruction}</div>`;
            }
            html += '<div class="visual-scale-options">';
            
            question.options.forEach((option, i) => {
                const id = `${question.id}_${i}`;
                html += `
                    <div class="visual-scale-option">
                        <input type="radio" id="${id}" name="${question.id}" value="${option.value}" class="visual-scale-radio">
                        <label for="${id}" class="visual-scale-label">
                            <div class="visual-representation">${option.visual}</div>
                            <div class="visual-description">${option.description}</div>
                        </label>
                    </div>
                `;
            });
            
            html += '</div></div>';
            return html;
        }
        
        // Render rapid association (timed response)
        function renderRapidAssociation(question) {
            const timeLimit = question.timeLimit || 5000;
            return `
                <div class="rapid-association" data-time-limit="${timeLimit}">
                    <div class="rapid-prompt">${question.text}</div>
                    ${question.instruction ? `<div class="rapid-instruction">${question.instruction}</div>` : ''}
                    <input type="text" 
                           class="rapid-input" 
                           id="${question.id}_input" 
                           placeholder="Type your response quickly..."
                           autocomplete="off">
                    <div class="rapid-timer" id="${question.id}_timer">
                        <div class="timer-bar" id="${question.id}_timer_bar"></div>
                    </div>
                </div>
            `;
        }
        
        // Render word association pairs
        function renderWordAssociation(question) {
            let html = '<div class="word-association">';
            html += `<div class="association-prompt">${question.text}</div>`;
            html += '<div class="word-pairs">';
            
            question.pairs.forEach((pair, i) => {
                const id = `${question.id}_${i}`;
                html += `
                    <div class="word-pair-option">
                        <input type="radio" id="${id}" name="${question.id}" value="${pair.value}" class="pair-radio">
                        <label for="${id}" class="pair-label">
                            <span class="word-1">${pair.pair[0]}</span>
                            <span class="pair-connector">+</span>
                            <span class="word-2">${pair.pair[1]}</span>
                        </label>
                    </div>
                `;
            });
            
            html += '</div></div>';
            return html;
        }
        
        function renderVisualGrid(question) {
            let html = '<div class="visual-grid">';
            question.options.forEach((option, i) => {
                html += `
                    <div class="visual-option" data-value="${option.value}" onclick="selectVisualOption(this, ${question.multiSelect})">
                        <div class="visual-emoji">${option.emoji}</div>
                        <div class="visual-text">${option.text}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderSlider(question) {
            const mid = (question.min + question.max) / 2;
            return `
                <div class="slider-container">
                    <div class="slider-track" id="sliderTrack">
                        <div class="slider-fill" id="sliderFill"></div>
                        <div class="slider-handle" id="sliderHandle" style="left: 50%;">
                            <div class="slider-value" id="sliderValue">${mid}</div>
                        </div>
                    </div>
                    <div class="slider-labels">
                        <span>${question.labels[0]}</span>
                        <span>${question.labels[1]}</span>
                        <span>${question.labels[2]}</span>
                    </div>
                    <input type="hidden" id="sliderInput" value="${mid}" min="${question.min}" max="${question.max}">
                </div>
            `;
        }

        function renderScenario(question) {
            let html = '<div class="scenario-options">';
            question.options.forEach((option, i) => {
                html += `
                    <div class="scenario-option visual-option" data-value="${option.value}" onclick="selectVisualOption(this, false)">
                        ${option.text}
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderFrequencyGrid(question) {
            let html = '<div class="frequency-grid"><table class="frequency-table"><thead><tr><th></th>';
            question.scale.forEach(label => {
                html += `<th>${label}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            question.items.forEach((item, itemIndex) => {
                html += `<tr><td>${item}</td>`;
                question.scale.forEach((label, scaleIndex) => {
                    html += `<td><div class="frequency-option" data-item="${itemIndex}" data-value="${scaleIndex}" onclick="selectFrequency(this, ${itemIndex})"></div></td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
            return html;
        }

        function renderTimePreference(question) {
            let html = '<div class="time-options">';
            question.options.forEach(option => {
                html += `
                    <div class="time-option" data-value="${option.value}" onclick="selectVisualOption(this, false)">
                        <div class="time-icon">${option.icon}</div>
                        <div>${option.text}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderTaskRanking(question) {
            let html = '<div class="ranking-container">';
            question.items.forEach((item, i) => {
                html += `
                    <div class="ranking-item" draggable="true" data-index="${i}">
                        <span class="ranking-number">${i + 1}</span>
                        <span class="ranking-text">${item}</span>
                        <span class="ranking-handle">â˜°</span>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderBodyMapping(question) {
            return `
                <div class="body-map">
                    <svg class="body-svg" viewBox="0 0 200 300">
                        <ellipse class="body-part" data-area="head" cx="100" cy="40" rx="25" ry="30"/>
                        <rect class="body-part" data-area="neck" x="90" y="65" width="20" height="20"/>
                        <rect class="body-part" data-area="shoulders" x="60" y="85" width="80" height="20"/>
                        <rect class="body-part" data-area="chest" x="75" y="105" width="50" height="40"/>
                        <rect class="body-part" data-area="stomach" x="75" y="145" width="50" height="40"/>
                        <rect class="body-part" data-area="back" x="80" y="85" width="40" height="100" opacity="0.5"/>
                        <rect class="body-part" data-area="limbs" x="50" y="105" width="20" height="80"/>
                        <rect class="body-part" data-area="limbs" x="130" y="105" width="20" height="80"/>
                        <rect class="body-part" data-area="limbs" x="80" y="185" width="15" height="80"/>
                        <rect class="body-part" data-area="limbs" x="105" y="185" width="15" height="80"/>
                    </svg>
                </div>
            `;
        }

        // Initialize question interactions
        function initializeQuestionInteractions(question) {
            if (question.type === 'slider') {
                initializeSlider(question);
            } else if (question.type === 'task_ranking') {
                initializeDragAndDrop();
            } else if (question.type === 'body_mapping') {
                initializeBodyMapping();
            } else if (question.type === 'rapid_association') {
                initializeRapidAssociation(question);
            }
            
            // Initialize biometric tracking if enabled
            if (assessmentConfig.biometricTracking) {
                initializeBiometricTracking();
            }
        }
        
        // Initialize rapid association timer
        function initializeRapidAssociation(question) {
            const timeLimit = question.timeLimit || 5000;
            const timerBar = document.getElementById(`${question.id}_timer_bar`);
            const input = document.getElementById(`${question.id}_input`);
            
            if (timerBar && input) {
                // Start timer animation
                timerBar.style.setProperty('--timer-duration', `${timeLimit}ms`);
                timerBar.classList.add('active');
                
                // Auto-submit after time limit
                setTimeout(() => {
                    if (currentQuestionIndex === assessmentQuestions.findIndex(q => q.id === question.id)) {
                        nextQuestion();
                    }
                }, timeLimit);
                
                // Focus input immediately
                input.focus();
            }
        }
        
        // Initialize biometric tracking
        function initializeBiometricTracking() {
            if (!experimentalAssessments) return;
            
            // Keystroke dynamics tracking
            if (!experimentalAssessments.keystrokeDynamics.enabled) {
                experimentalAssessments.keystrokeDynamics.enabled = true;
                
                let lastKeyTime = Date.now();
                
                document.addEventListener('keydown', (e) => {
                    const currentTime = Date.now();
                    const flightTime = currentTime - lastKeyTime;
                    
                    experimentalAssessments.keystrokeDynamics.metrics.flightTime.push(flightTime);
                    experimentalAssessments.keystrokeDynamics.metrics.dwellTime.push(0); // Start dwell timer
                    
                    lastKeyTime = currentTime;
                });
                
                document.addEventListener('keyup', (e) => {
                    const dwellTime = Date.now() - lastKeyTime;
                    const lastIndex = experimentalAssessments.keystrokeDynamics.metrics.dwellTime.length - 1;
                    if (lastIndex >= 0) {
                        experimentalAssessments.keystrokeDynamics.metrics.dwellTime[lastIndex] = dwellTime;
                    }
                });
            }
            
            // Mouse movement tracking
            if (!experimentalAssessments.mouseTracking.enabled) {
                experimentalAssessments.mouseTracking.enabled = true;
                
                let mouseTrajectory = [];
                let lastMouseTime = Date.now();
                let lastX = 0, lastY = 0;
                
                document.addEventListener('mousemove', (e) => {
                    const currentTime = Date.now();
                    const deltaTime = currentTime - lastMouseTime;
                    
                    if (deltaTime > 50) { // Sample every 50ms
                        const deltaX = e.clientX - lastX;
                        const deltaY = e.clientY - lastY;
                        const velocity = Math.sqrt(deltaX * deltaX + deltaY * deltaY) / deltaTime;
                        
                        mouseTrajectory.push({ x: e.clientX, y: e.clientY, t: currentTime });
                        experimentalAssessments.mouseTracking.metrics.velocity.push(velocity);
                        
                        if (mouseTrajectory.length > 2) {
                            const accel = (velocity - experimentalAssessments.mouseTracking.metrics.velocity[experimentalAssessments.mouseTracking.metrics.velocity.length - 2]) / deltaTime;
                            experimentalAssessments.mouseTracking.metrics.acceleration.push(accel);
                        }
                        
                        lastMouseTime = currentTime;
                        lastX = e.clientX;
                        lastY = e.clientY;
                    }
                });
                
                document.addEventListener('click', (e) => {
                    experimentalAssessments.mouseTracking.metrics.clicks.push({
                        x: e.clientX,
                        y: e.clientY,
                        t: Date.now()
                    });
                });
                
                // Calculate trajectory metrics periodically
                setInterval(() => {
                    if (mouseTrajectory.length > 10) {
                        experimentalAssessments.mouseTracking.metrics.trajectories.push([...mouseTrajectory]);
                        
                        // Calculate MAD and AUC
                        const xCoords = mouseTrajectory.map(p => p.x);
                        const yCoords = mouseTrajectory.map(p => p.y);
                        const maxX = Math.max(...xCoords);
                        const minX = Math.min(...xCoords);
                        const maxY = Math.max(...yCoords);
                        const minY = Math.min(...yCoords);
                        
                        experimentalAssessments.mouseTracking.metrics.MAD = Math.max(maxX - minX, maxY - minY);
                        
                        // Simple AUC calculation
                        let auc = 0;
                        for (let i = 1; i < mouseTrajectory.length; i++) {
                            auc += Math.abs(mouseTrajectory[i].x - mouseTrajectory[i-1].x) * 
                                   Math.abs(mouseTrajectory[i].y - mouseTrajectory[i-1].y);
                        }
                        experimentalAssessments.mouseTracking.metrics.AUC = auc;
                        
                        mouseTrajectory = []; // Reset for next interval
                    }
                }, 5000); // Every 5 seconds
            }
        }

        // Initialize slider
        function initializeSlider(question) {
            const track = document.getElementById('sliderTrack');
            const handle = document.getElementById('sliderHandle');
            const fill = document.getElementById('sliderFill');
            const value = document.getElementById('sliderValue');
            const input = document.getElementById('sliderInput');
            
            let isDragging = false;
            
            handle.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            handle.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', stopDrag);
            
            function startDrag(e) {
                isDragging = true;
                handle.style.cursor = 'grabbing';
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const rect = track.getBoundingClientRect();
                const clientX = e.clientX || e.touches[0].clientX;
                let x = clientX - rect.left;
                x = Math.max(0, Math.min(x, rect.width));
                
                const percent = (x / rect.width) * 100;
                handle.style.left = `${percent}%`;
                fill.style.width = `${percent}%`;
                
                const val = Math.round(question.min + (percent / 100) * (question.max - question.min));
                value.textContent = val;
                input.value = val;
            }
            
            function stopDrag() {
                isDragging = false;
                handle.style.cursor = 'grab';
            }
        }

        // Initialize drag and drop
        function initializeDragAndDrop() {
            const items = document.querySelectorAll('.ranking-item');
            let draggedElement = null;
            
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedElement = e.target;
                    e.target.classList.add('dragging');
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
                
                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(e.currentTarget.parentNode, e.clientY);
                    if (afterElement == null) {
                        e.currentTarget.parentNode.appendChild(draggedElement);
                    } else {
                        e.currentTarget.parentNode.insertBefore(draggedElement, afterElement);
                    }
                    updateRankingNumbers();
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.ranking-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function updateRankingNumbers() {
            document.querySelectorAll('.ranking-item').forEach((item, index) => {
                item.querySelector('.ranking-number').textContent = index + 1;
            });
        }

        // Initialize body mapping
        function initializeBodyMapping() {
            document.querySelectorAll('.body-part').forEach(part => {
                part.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
        }

        // Selection handlers
        function selectVisualOption(element, multiSelect) {
            if (multiSelect) {
                element.classList.toggle('selected');
            } else {
                document.querySelectorAll('.visual-option, .time-option').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
            }
        }

        function selectFrequency(element, itemIndex) {
            document.querySelectorAll(`[data-item="${itemIndex}"]`).forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        // Navigation
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                saveResponse();
                showQuestion(currentQuestionIndex - 1);
            }
        }

        function nextQuestion() {
            saveResponse();
            
            if (currentQuestionIndex < assessmentQuestions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            } else {
                completeAssessment();
            }
        }

        // Save response
        function saveResponse() {
            const question = assessmentQuestions[currentQuestionIndex];
            const responseTime = Date.now() - questionStartTime;
            
            let response = {
                questionId: question.id,
                type: question.type,
                category: question.category,
                responseTime: responseTime,
                value: null
            };
            
            switch(question.type) {
                case 'visual_grid':
                case 'scenario':
                case 'time_preference':
                    const selected = document.querySelectorAll('.visual-option.selected, .time-option.selected');
                    if (question.multiSelect) {
                        response.value = Array.from(selected).map(el => el.dataset.value);
                    } else {
                        response.value = selected[0]?.dataset.value;
                    }
                    break;
                    
                case 'likert':
                    const likertSelected = document.querySelector(`input[name="${question.id}"]:checked`);
                    response.value = likertSelected?.value;
                    break;
                    
                case 'frequency':
                    const freqSelected = document.querySelector(`input[name="${question.id}"]:checked`);
                    response.value = freqSelected?.value;
                    break;
                    
                case 'slider':
                    response.value = document.getElementById('sliderInput')?.value;
                    break;
                    
                case 'problem':
                    response.value = document.getElementById(`${question.id}_input`)?.value;
                    break;
                    
                case 'frequency_grid':
                    response.value = {};
                    document.querySelectorAll('.frequency-option.selected').forEach(opt => {
                        const item = question.items[opt.dataset.item];
                        response.value[item] = parseInt(opt.dataset.value);
                    });
                    break;
                    
                case 'task_ranking':
                    response.value = Array.from(document.querySelectorAll('.ranking-item')).map(
                        item => item.querySelector('.ranking-text').textContent
                    );
                    break;
                    
                case 'body_mapping':
                    response.value = Array.from(document.querySelectorAll('.body-part.selected')).map(
                        part => part.dataset.area
                    );
                    break;
                    
                case 'situational_judgment':
                    const sjSelected = document.querySelector(`input[name="${question.id}"]:checked`);
                    if (sjSelected) {
                        const optionIndex = parseInt(sjSelected.value);
                        response.value = {
                            index: optionIndex,
                            ...question.options[optionIndex]
                        };
                    }
                    break;
                    
                case 'forced_choice':
                    const fcSelected = document.querySelector(`input[name="${question.id}"]:checked`);
                    if (fcSelected) {
                        const optionIndex = parseInt(fcSelected.value);
                        response.value = {
                            index: optionIndex,
                            trait: question.options[optionIndex].trait,
                            text: question.options[optionIndex].text
                        };
                    }
                    break;
                    
                case 'visual_scale':
                    const vsSelected = document.querySelector(`input[name="${question.id}"]:checked`);
                    response.value = vsSelected?.value;
                    break;
                    
                case 'rapid_association':
                    const rapidInput = document.getElementById(`${question.id}_input`);
                    response.value = rapidInput?.value;
                    // Add response latency for IAT-style analysis
                    response.latency = responseTime;
                    response.timed = true;
                    break;
                    
                case 'word_association':
                    const waSelected = document.querySelector(`input[name="${question.id}"]:checked`);
                    response.value = waSelected?.value;
                    // Track selection speed for implicit association
                    response.latency = responseTime;
                    break;
            }
            
            // Track biometric data if enabled
            if (assessmentConfig.biometricTracking && experimentalAssessments) {
                if (experimentalAssessments.keystrokeDynamics.enabled) {
                    response.keystrokeMetrics = {
                        dwellTime: experimentalAssessments.keystrokeDynamics.metrics.dwellTime.slice(-10),
                        flightTime: experimentalAssessments.keystrokeDynamics.metrics.flightTime.slice(-10)
                    };
                }
                if (experimentalAssessments.mouseTracking.enabled) {
                    response.mouseMetrics = {
                        trajectoryLength: experimentalAssessments.mouseTracking.metrics.trajectories.length,
                        clicks: experimentalAssessments.mouseTracking.metrics.clicks.length
                    };
                }
            }
            
            responses[question.id] = response;
            questionStartTime = Date.now();
        }

        // Complete assessment
        function completeAssessment() {
            clearInterval(timeElapsedInterval);
            
            document.getElementById('assessmentContainer').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            
            setTimeout(() => {
                const results = calculateResults();
                displayResults(results);
            }, 3000);
        }

        // =====================================
        // PSYCHOMETRIC SCORING ENGINE
        // =====================================
        
        // Advanced scoring with Item Response Theory principles
        function calculateResults() {
            const totalTime = Date.now() - startTime;
            const responseTimes = [];
            
            // Initialize domain scores
            const domainScores = {
                // Big Five domains with facets
                extraversion: { score: 0, facets: { sociability: 0, assertiveness: 0, energy_level: 0 }, items: 0 },
                agreeableness: { score: 0, facets: { compassion: 0, respectfulness: 0, trust: 0 }, items: 0 },
                conscientiousness: { score: 0, facets: { organization: 0, productiveness: 0, responsibility: 0 }, items: 0 },
                neuroticism: { score: 0, facets: { anxiety: 0, depression: 0, emotional_volatility: 0 }, items: 0 },
                openness: { score: 0, facets: { intellectual_curiosity: 0, aesthetic_sensitivity: 0, creative_imagination: 0 }, items: 0 },
                
                // HEXACO addition
                honesty_humility: { score: 0, facets: { sincerity: 0, fairness: 0, greed_avoidance: 0, modesty: 0 }, items: 0 },
                
                // Dark Tetrad
                dark_traits: {
                    machiavellianism: { score: 0, items: 0 },
                    narcissism: { score: 0, items: 0 },
                    psychopathy: { score: 0, items: 0 },
                    sadism: { score: 0, items: 0 }
                },
                
                // Neurodiversity
                neurodiversity: {
                    adhd: { inattention: 0, hyperactivity: 0, total_score: 0, items: 0 },
                    autism: { score: 0, items: 0, raads_score: 0 },
                    sensory: { sensitivity: 0, seeking: 0, avoiding: 0, registration: 0 },
                    executive: { inhibit: 0, shift: 0, emotional_control: 0, initiate: 0, working_memory: 0, plan: 0, monitor: 0, organization: 0 }
                },
                
                // Emotional & Social
                emotional: {
                    regulation: { reappraisal: 0, suppression: 0, items: 0 },
                    difficulties: { clarity: 0, goals: 0, impulse: 0, awareness: 0, strategies: 0, nonacceptance: 0 },
                    empathy: { perspective_taking: 0, fantasy: 0, empathic_concern: 0, personal_distress: 0 },
                    alexithymia: { identify: 0, describe: 0, external: 0, total: 0 }
                },
                
                // Stress & Coping
                wellbeing: {
                    stress: { perceived: 0, coping_efficacy: 0, items: 0 },
                    resilience: { score: 0, items: 0 },
                    coping: { problem_focused: 0, emotion_focused: 0, dysfunctional: 0 }
                },
                
                // Cognitive Styles
                cognitive: {
                    need_for_cognition: 0,
                    reflection_score: 0,
                    thinking_style: { rational: 0, experiential: 0 },
                    decision_style: { rational: 0, intuitive: 0, dependent: 0, avoidant: 0, spontaneous: 0 },
                    metacognition: { knowledge: 0, regulation: 0 },
                    mindfulness: 0
                },
                
                // Motivation
                motivation: {
                    basic_needs: { autonomy: 0, competence: 0, relatedness: 0 },
                    achievement_goals: { mastery_approach: 0, mastery_avoidance: 0, performance_approach: 0, performance_avoidance: 0 },
                    grit: { perseverance: 0, passion: 0 }
                }
            };
            
            // Response quality metrics
            const qualityMetrics = {
                responseTime: { total: totalTime, average: 0, tooFast: 0, tooSlow: 0 },
                consistency: { internal: 0, temporal: 0 },
                socialDesirability: 0,
                carelessResponding: 0,
                longString: 0,
                mahalanobis: 0,
                validResponses: 0,
                invalidResponses: 0
            };
            
            // Process each response with proper scoring
            Object.entries(responses).forEach(([questionId, response]) => {
                const question = findQuestionById(questionId);
                if (!question || !response) return;
                
                // Track response time
                if (response.responseTime) {
                    responseTimes.push(response.responseTime);
                    if (response.responseTime < biasDetection.responseTime.flagThreshold) {
                        qualityMetrics.tooFast++;
                    }
                }
                
                // Score based on instrument and scoring method
                const score = scoreItem(question, response);
                
                // Apply to appropriate domain
                applyScoreToDomain(domainScores, question, score);
                
                qualityMetrics.validResponses++;
            });
            
            // Calculate average response time
            if (responseTimes.length > 0) {
                qualityMetrics.responseTime.average = responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length;
            }
            
            // Detect response biases
            const biasResults = detectResponseBiases(responses, qualityMetrics);
            
            // Normalize scores to percentiles using norms
            const normalizedScores = normalizeScores(domainScores);
            
            // Calculate clinical indicators
            const clinicalIndicators = calculateClinicalIndicators(normalizedScores);
            
            // Generate comprehensive profile
            const profile = generateComprehensiveProfile(normalizedScores, clinicalIndicators);
            
            // Calculate match confidence using psychometric principles
            const matchConfidence = calculateMatchConfidence(qualityMetrics, responseTimes.length);
            
            return {
                profile: profile,
                scores: normalizedScores,
                rawScores: domainScores,
                clinicalIndicators: clinicalIndicators,
                qualityMetrics: qualityMetrics,
                biasIndicators: biasResults,
                totalTime: totalTime,
                responseCount: Object.keys(responses).length,
                matchConfidence: matchConfidence,
                assessmentTier: assessmentConfig.currentTier,
                timestamp: new Date().toISOString()
            };
        }
        
        // Helper function to find question by ID
        function findQuestionById(id) {
            const allQuestions = [...coreScreeningQuestions, ...comprehensiveAssessmentQuestions, ...Object.values(specializedModules).flat()];
            return allQuestions.find(q => q.id === id);
        }
        
        // Score individual item based on type and method
        function scoreItem(question, response) {
            let score = 0;
            const value = response.value;
            
            switch (question.type) {
                case 'likert':
                    score = question.scoring === 'reverse' ? 
                        (question.scale + 1 - parseInt(value)) : parseInt(value);
                    break;
                    
                case 'frequency':
                    const freqMap = { 'Never': 1, 'Rarely': 2, 'Sometimes': 3, 'Often': 4, 'Very Often': 5, 'Always': 5 };
                    score = freqMap[value] || parseInt(value);
                    if (question.scoring === 'reverse') {
                        score = 6 - score;
                    }
                    break;
                    
                case 'slider':
                    score = parseInt(value);
                    if (question.scoring === 'reverse') {
                        score = (question.max || 7) + 1 - score;
                    }
                    break;
                    
                case 'visual_grid':
                case 'scenario':
                    // Handle complex response types
                    if (typeof value === 'object') {
                        score = value.score || 3;
                    } else {
                        score = parseInt(value) || 3;
                    }
                    break;
                    
                default:
                    score = parseInt(value) || 0;
            }
            
            // Apply clinical weighting if present
            if (question.clinical_weight) {
                score *= question.clinical_weight;
            }
            
            return score;
        }
        
        // Apply score to appropriate domain
        function applyScoreToDomain(domains, question, score) {
            const category = question.category;
            const facet = question.facet;
            
            // Big Five domains
            if (['extraversion', 'agreeableness', 'conscientiousness', 'neuroticism', 'openness'].includes(category)) {
                domains[category].score += score;
                domains[category].items++;
                if (facet && domains[category].facets[facet] !== undefined) {
                    domains[category].facets[facet] += score;
                }
            }
            
            // HEXACO Honesty-Humility
            else if (category === 'honesty_humility') {
                domains.honesty_humility.score += score;
                domains.honesty_humility.items++;
                if (facet && domains.honesty_humility.facets[facet] !== undefined) {
                    domains.honesty_humility.facets[facet] += score;
                }
            }
            
            // Dark traits
            else if (category.startsWith('dark_')) {
                const trait = category.replace('dark_', '');
                if (domains.dark_traits[trait]) {
                    domains.dark_traits[trait].score += score;
                    domains.dark_traits[trait].items++;
                }
            }
            
            // ADHD
            else if (category.startsWith('adhd_')) {
                const subtype = category.replace('adhd_', '');
                domains.neurodiversity.adhd[subtype] += score;
                domains.neurodiversity.adhd.total_score += score;
                domains.neurodiversity.adhd.items++;
            }
            
            // Autism
            else if (category.startsWith('asd_')) {
                domains.neurodiversity.autism.score += score;
                domains.neurodiversity.autism.items++;
                if (question.instrument === 'RAADS-R') {
                    domains.neurodiversity.autism.raads_score += score;
                }
            }
            
            // Executive function
            else if (category.startsWith('executive_')) {
                const function_type = category.replace('executive_', '');
                if (domains.neurodiversity.executive[function_type] !== undefined) {
                    domains.neurodiversity.executive[function_type] += score;
                }
            }
            
            // Emotion regulation
            else if (category.startsWith('emotion_')) {
                const subtype = category.replace('emotion_', '');
                if (subtype === 'reappraisal' || subtype === 'suppression') {
                    domains.emotional.regulation[subtype] += score;
                    domains.emotional.regulation.items++;
                } else if (domains.emotional.difficulties[subtype] !== undefined) {
                    domains.emotional.difficulties[subtype] += score;
                }
            }
            
            // Empathy
            else if (category.startsWith('empathy_')) {
                const subtype = category.replace('empathy_', '');
                if (domains.emotional.empathy[subtype] !== undefined) {
                    domains.emotional.empathy[subtype] += score;
                }
            }
            
            // Stress & Resilience
            else if (category === 'stress_perception' || category === 'stress_coping') {
                domains.wellbeing.stress.perceived += score;
                domains.wellbeing.stress.items++;
            } else if (category === 'resilience') {
                domains.wellbeing.resilience.score += score;
                domains.wellbeing.resilience.items++;
            }
            
            // Coping
            else if (category.startsWith('coping_')) {
                const style = category.replace('coping_', '');
                if (domains.wellbeing.coping[style + '_focused'] !== undefined) {
                    domains.wellbeing.coping[style + '_focused'] += score;
                } else if (style === 'dysfunctional') {
                    domains.wellbeing.coping.dysfunctional += score;
                }
            }
        }
        
        // Detect response biases
        function detectResponseBiases(responses, metrics) {
            const biases = {
                acquiescence: 0,
                extremeResponding: 0,
                centralTendency: 0,
                socialDesirability: 0,
                inconsistency: 0
            };
            
            const values = Object.values(responses).map(r => parseInt(r.value) || 0);
            const mean = values.reduce((a, b) => a + b, 0) / values.length;
            const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;
            
            // Detect acquiescence (tendency to agree)
            const agreeCount = values.filter(v => v >= 4).length;
            biases.acquiescence = (agreeCount / values.length) * 100;
            
            // Detect extreme responding
            const extremeCount = values.filter(v => v === 1 || v === 5).length;
            biases.extremeResponding = (extremeCount / values.length) * 100;
            
            // Detect central tendency
            const centralCount = values.filter(v => v === 3).length;
            biases.centralTendency = (centralCount / values.length) * 100;
            
            // Check for long strings (consecutive same responses)
            let maxConsecutive = 1;
            let currentConsecutive = 1;
            for (let i = 1; i < values.length; i++) {
                if (values[i] === values[i-1]) {
                    currentConsecutive++;
                    maxConsecutive = Math.max(maxConsecutive, currentConsecutive);
                } else {
                    currentConsecutive = 1;
                }
            }
            metrics.longString = maxConsecutive;
            
            return biases;
        }
        
        // Normalize scores using population norms
        function normalizeScores(rawScores) {
            const normalized = {};
            
            // Big Five normalization
            ['extraversion', 'agreeableness', 'conscientiousness', 'neuroticism', 'openness'].forEach(trait => {
                if (rawScores[trait] && rawScores[trait].items > 0) {
                    const rawMean = rawScores[trait].score / rawScores[trait].items;
                    const norm = psychometricData.bigFive.norms[trait];
                    const zScore = (rawMean - norm.mean) / norm.sd;
                    normalized[trait] = {
                        percentile: normalCDF(zScore) * 100,
                        stanine: Math.min(9, Math.max(1, Math.round(zScore * 2 + 5))),
                        tScore: Math.round(zScore * 10 + 50),
                        raw: rawMean,
                        facets: {}
                    };
                    
                    // Normalize facets
                    Object.entries(rawScores[trait].facets).forEach(([facet, score]) => {
                        normalized[trait].facets[facet] = score / Math.max(1, rawScores[trait].items / 3);
                    });
                }
            });
            
            // HEXACO normalization
            if (rawScores.honesty_humility && rawScores.honesty_humility.items > 0) {
                const rawMean = rawScores.honesty_humility.score / rawScores.honesty_humility.items;
                normalized.honesty_humility = {
                    percentile: Math.min(95, Math.max(5, rawMean * 20)),
                    raw: rawMean
                };
            }
            
            // Clinical scores normalization
            // ADHD
            if (rawScores.neurodiversity && rawScores.neurodiversity.adhd && rawScores.neurodiversity.adhd.items > 0) {
                const adhdScore = rawScores.neurodiversity.adhd.total_score;
                normalized.adhd = {
                    total: adhdScore,
                    clinical: adhdScore >= psychometricData.adhd.cutoff,
                    percentile: adhdScore * 100 / (rawScores.neurodiversity.adhd.items * 5),
                    inattention: rawScores.neurodiversity.adhd.inattention,
                    hyperactivity: rawScores.neurodiversity.adhd.hyperactivity
                };
            }
            
            // Autism
            if (rawScores.neurodiversity && rawScores.neurodiversity.autism && rawScores.neurodiversity.autism.items > 0) {
                const asdScore = rawScores.neurodiversity.autism.score;
                normalized.autism = {
                    total: asdScore,
                    clinical: asdScore >= psychometricData.autism.cutoff,
                    percentile: Math.min(95, asdScore * 100 / (rawScores.neurodiversity.autism.items * 4)),
                    raads: rawScores.neurodiversity.autism.raads_score
                };
            }
            
            // Stress
            if (rawScores.wellbeing.stress.items > 0) {
                const stressScore = rawScores.wellbeing.stress.perceived / rawScores.wellbeing.stress.items;
                const zScore = (stressScore - psychometricData.stress.communityMean) / psychometricData.stress.sd;
                normalized.stress = {
                    percentile: normalCDF(zScore) * 100,
                    raw: stressScore,
                    level: stressScore > 20 ? 'high' : stressScore > 14 ? 'moderate' : 'low'
                };
            }
            
            // Resilience
            if (rawScores.wellbeing.resilience.items > 0) {
                const resilienceScore = rawScores.wellbeing.resilience.score / rawScores.wellbeing.resilience.items;
                const zScore = (resilienceScore - psychometricData.resilience.communityMean) / psychometricData.resilience.sd;
                normalized.resilience = {
                    percentile: normalCDF(zScore) * 100,
                    raw: resilienceScore,
                    level: resilienceScore > 35 ? 'high' : resilienceScore > 25 ? 'moderate' : 'low'
                };
            }
            
            // Dark traits
            Object.entries(rawScores.dark_traits).forEach(([trait, data]) => {
                if (data.items > 0) {
                    normalized[`dark_${trait}`] = {
                        percentile: Math.min(95, (data.score / (data.items * 5)) * 100),
                        raw: data.score / data.items,
                        clinical: data.score / data.items > 3.5
                    };
                }
            });
            
            return normalized;
        }
        
        // Normal CDF for z-score to percentile conversion
        function normalCDF(z) {
            const a1 = 0.254829592;
            const a2 = -0.284496736;
            const a3 = 1.421413741;
            const a4 = -1.453152027;
            const a5 = 1.061405429;
            const p = 0.3275911;
            
            const sign = z < 0 ? -1 : 1;
            z = Math.abs(z) / Math.sqrt(2);
            
            const t = 1 / (1 + p * z);
            const y = 1 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-z * z);
            
            return 0.5 * (1 + sign * y);
        }
        
        // Calculate clinical indicators
        function calculateClinicalIndicators(scores) {
            const indicators = {
                flags: [],
                strengths: [],
                recommendations: []
            };
            
            // Check for clinical-level scores
            if (scores.adhd && scores.adhd.clinical) {
                indicators.flags.push('ADHD screening positive - consider professional evaluation');
                indicators.recommendations.push('Executive function support strategies may be helpful');
            }
            
            if (scores.autism && scores.autism.clinical) {
                indicators.flags.push('Autism traits elevated - neurodiversity-affirming support recommended');
                indicators.strengths.push('Detail-oriented processing and pattern recognition');
            }
            
            if (scores.stress && scores.stress.level === 'high') {
                indicators.flags.push('Elevated stress levels detected');
                indicators.recommendations.push('Stress management techniques recommended');
            }
            
            if (scores.resilience && scores.resilience.level === 'high') {
                indicators.strengths.push('High resilience and adaptability');
            }
            
            // Check dark traits
            ['machiavellianism', 'narcissism', 'psychopathy', 'sadism'].forEach(trait => {
                if (scores[`dark_${trait}`] && scores[`dark_${trait}`].clinical) {
                    indicators.flags.push(`Elevated ${trait} traits - self-awareness important`);
                }
            });
            
            // Identify personality strengths
            ['extraversion', 'agreeableness', 'conscientiousness', 'openness'].forEach(trait => {
                if (scores[trait] && scores[trait].percentile > 70) {
                    indicators.strengths.push(`High ${trait} (${Math.round(scores[trait].percentile)}th percentile)`);
                }
            });
            
            if (scores.neuroticism && scores.neuroticism.percentile < 30) {
                indicators.strengths.push('Emotional stability');
            }
            
            return indicators;
        }
        
        // Generate comprehensive profile
        function generateComprehensiveProfile(scores, indicators) {
            // Find best matching archetype based on pattern matching
            let bestMatch = null;
            let bestScore = -1;
            
            personalityProfiles.forEach(profile => {
                let matchScore = 0;
                let matchCount = 0;
                
                // Match Big Five patterns
                ['extraversion', 'agreeableness', 'conscientiousness', 'neuroticism', 'openness'].forEach(trait => {
                    if (scores[trait] && profile.traits[trait]) {
                        const diff = Math.abs(scores[trait].percentile - profile.traits[trait].score);
                        matchScore += (100 - diff);
                        matchCount++;
                    }
                });
                
                // Consider HEXACO if available
                if (scores.honesty_humility && profile.traits.honestyHumility) {
                    const diff = Math.abs(scores.honesty_humility.percentile - profile.traits.honestyHumility.score);
                    matchScore += (100 - diff);
                    matchCount++;
                }
                
                if (matchCount > 0) {
                    const avgMatch = matchScore / matchCount;
                    if (avgMatch > bestScore) {
                        bestScore = avgMatch;
                        bestMatch = profile;
                    }
                }
            });
            
            // Enhance profile with clinical insights
            if (bestMatch) {
                bestMatch.clinicalIndicators = indicators;
                bestMatch.matchPercentage = Math.round(bestScore);
            }
            
            return bestMatch || personalityProfiles[0];
        }
        
        // Calculate match confidence
        function calculateMatchConfidence(metrics, responseCount) {
            let confidence = 100;
            
            // Reduce confidence for insufficient responses
            if (responseCount < 30) confidence -= 20;
            else if (responseCount < 60) confidence -= 10;
            
            // Reduce confidence for response biases
            if (metrics.tooFast > responseCount * 0.1) confidence -= 15;
            if (metrics.longString > 5) confidence -= 10;
            
            // Reduce confidence for extreme response styles
            if (metrics.responseTime.average < 2000) confidence -= 10;
            
            return Math.max(40, Math.min(95, confidence));
        }

        // Display results
        function displayResults(results) {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            
            const container = document.getElementById('resultsContainer');
            
            // Ensure neuroScores exist with default values
            if (!results.neuroScores) {
                results.neuroScores = {
                    adhdTraits: 50,
                    autismTraits: 50,
                    sensitivity: 50,
                    executiveFunction: 50
                };
            }
            
            let html = `
                <div class="results-header">
                    <h2 class="results-title">Your Personality Profile</h2>
                    <p style="color: var(--text-secondary); font-size: 1.125rem;">
                        Based on ${results.responseCount} responses over ${Math.round(results.totalTime / 60000)} minutes
                    </p>
                </div>
                
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-emoji">${results.profile.emoji}</div>
                        <div class="profile-info">
                            <h3 class="profile-name">${results.profile.name}</h3>
                            <p class="profile-description">${results.profile.description}</p>
                        </div>
                    </div>
                </div>
                
                <div class="traits-visualization">
                    <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--neural-blue);">Personality Dimensions</h3>
                    <div class="trait-bars">
            `;
            
            Object.entries(results.scores).forEach(([trait, score]) => {
                const level = score > 70 ? 'high' : score > 40 ? 'medium' : 'low';
                html += `
                    <div class="trait-bar">
                        <div class="trait-name">${trait.charAt(0).toUpperCase() + trait.slice(1).replace(/([A-Z])/g, ' $1')}</div>
                        <div class="trait-progress">
                            <div class="trait-fill ${level}" style="width: ${score}%"></div>
                        </div>
                        <div class="trait-score">${Math.round(score)}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <div class="neuro-indicators">
                    <h3 style="font-size: 1.5rem; margin-bottom: 1rem; color: var(--neural-purple);">Neurodiversity Profile</h3>
                    <div class="neuro-grid">
                        <div class="neuro-indicator">
                            <div class="neuro-icon">ðŸ§ </div>
                            <div class="neuro-label">ADHD Traits</div>
                            <div class="neuro-value ${results.neuroScores.adhdTraits > 70 ? 'high' : results.neuroScores.adhdTraits > 40 ? 'medium' : 'low'}">${results.neuroScores.adhdTraits}%</div>
                        </div>
                        <div class="neuro-indicator">
                            <div class="neuro-icon">ðŸ§©</div>
                            <div class="neuro-label">Autism Traits</div>
                            <div class="neuro-value ${results.neuroScores.autismTraits > 70 ? 'high' : results.neuroScores.autismTraits > 40 ? 'medium' : 'low'}">${results.neuroScores.autismTraits}%</div>
                        </div>
                        <div class="neuro-indicator">
                            <div class="neuro-icon">ðŸŒº</div>
                            <div class="neuro-label">Sensitivity</div>
                            <div class="neuro-value ${results.neuroScores.sensitivity > 70 ? 'high' : results.neuroScores.sensitivity > 40 ? 'medium' : 'low'}">${results.neuroScores.sensitivity}%</div>
                        </div>
                        <div class="neuro-indicator">
                            <div class="neuro-icon">âš™ï¸</div>
                            <div class="neuro-label">Executive Function</div>
                            <div class="neuro-value ${results.neuroScores.executiveFunction > 70 ? 'high' : results.neuroScores.executiveFunction > 40 ? 'medium' : 'low'}">${results.neuroScores.executiveFunction}%</div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-tabs">
                    <button class="tab-button active" onclick="switchTab('strengths')">Strengths</button>
                    <button class="tab-button" onclick="switchTab('growth')">Growth</button>
                    <button class="tab-button" onclick="switchTab('relationships')">Relationships</button>
                    <button class="tab-button" onclick="switchTab('career')">Career</button>
                </div>
                
                <div class="tab-content active" id="tab-strengths">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Your Core Strengths</h3>
                        <div class="analysis-content">
                            <ul class="insight-list">
            `;
            
            if (results.profile.detailedAnalysis && results.profile.detailedAnalysis.strengths) {
                results.profile.detailedAnalysis.strengths.forEach(strength => {
                    html += `<li class="insight-item">${strength}</li>`;
                });
            }
            
            html += `
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-growth">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Growth Opportunities</h3>
                        <div class="analysis-content">
                            <p>${results.profile.detailedAnalysis?.growth || 'Continue leveraging your unique strengths while exploring new areas of growth.'}</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-relationships">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Relationship Insights</h3>
                        <div class="analysis-content">
                            <p>${results.profile.detailedAnalysis?.relationships || 'Build authentic connections that honor your personality.'}</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-career">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Career Paths</h3>
                        <div class="analysis-content">
                            <ul class="insight-list">
            `;
            
            if (results.profile.detailedAnalysis && results.profile.detailedAnalysis.career) {
                results.profile.detailedAnalysis.career.forEach(career => {
                    html += `<li class="insight-item">${career}</li>`;
                });
            }
            
            html += `
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 3rem;">
                    <button class="btn btn-primary" onclick="downloadResults()">
                        <span>ðŸ“¥</span>
                        <span>Download Report</span>
                    </button>
                    <button class="btn btn-secondary" onclick="retakeAssessment()">
                        <span>ðŸ”„</span>
                        <span>Retake Assessment</span>
                    </button>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Try to show confetti, but don't fail if CSP blocks it
            try {
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                }
            } catch (error) {
                console.log('Confetti animation blocked by CSP, using CSS animation instead');
                // Add a CSS celebration animation as fallback
                container.classList.add('celebration-animation');
                setTimeout(() => {
                    container.classList.remove('celebration-animation');
                }, 3000);
            }
            
            userProfile = results;
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Download results
        function downloadResults() {
            const report = {
                timestamp: new Date().toISOString(),
                profile: userProfile.profile,
                scores: userProfile.scores,
                neuroScores: userProfile.neuroScores,
                responses: responses
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `patricia-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Retake assessment
        function retakeAssessment() {
            currentQuestionIndex = 0;
            responses = {};
            startTime = null;
            questionStartTime = null;
            userProfile = null;
            
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('progressBar').style.width = '0%';
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initNeuralBackground();
        });
    </script>
</body>
</html>